<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" />

    <link type="text/css" href="http://www.pathfinder-fr.org/Wiki/public/upload/Battlemaps/Fichiers/jQuery/jquery-custom-ancien-site.css" rel="stylesheet" />
    <script type="text/javascript" src="http://www.pathfinder-fr.org/Wiki/public/upload/Battlemaps/Fichiers/jQuery/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="http://www.pathfinder-fr.org/Wiki/public/upload/Battlemaps/Fichiers/jQuery/jquery-ui-1.8.12.custom.min.js"></script>

    <style>
        .tabletop {
            width: 100%;
            background-color: #f3efe2;
            border: 1px solid #4b3124;
            font-size: 11pt;
            margin-bottom: 6px;
        }

        #maintarget {
            font-size: 10pt;
        }

        .fdptab {
            padding: 5px !important;
            font-family: serif;
        }

            .fdptab table {
                width: 100%;
                border-spacing: 5px;
            }

                .fdptab table.tabcpt {
                    border-spacing: 0;
                    border-collapse: collapse;
                    margin: 2px;
                }

            .fdptab tr {
                vertical-align: top;
            }

            .fdptab td {
                padding: 0px;
                border: 1px solid #4b3124;
                box-shadow: 2px 2px 1px #888;
                font-size: 11pt;
            }

            .fdptab table.tabcpt td {
                border: 0;
                box-shadow: none;
            }

            .fdptab td p {
                margin: 2px;
            }

                .fdptab td p.fdpta {
                    background-color: #EFEFEF;
                    padding: 3px;
                    font-family: monospace;
                    font-size: 8pt;
                    margin: 0;
                }

                .fdptab td p.fdpst {
                    border-bottom: 2px solid #4b3124;
                    background-color: #f3efe2;
                    padding: 3px;
                    margin: 0px;
                    font-size: 10pt;
                    text-transform: uppercase;
                    font-weight: bold;
                }

            .fdptab td ul {
                padding-left: 18px;
                margin-top: 5px;
            }

            .fdptab a {
                color: blue;
            }

            .fdptab img.btntogglesortsindisponibles {
                float: right;
                padding-right: 3px;
                padding-top: 3px;
                width: 16px;
                height: 16px;
                opacity: .5;
            }

                .fdptab img.btntogglesortsindisponibles:hover {
                    opacity: 1;
                }
    </style>

</head>
<body>

    <div>
        <table cellspacing=0 cellpadding=0 class="tabletop">
            <tr style='vertical-align: middle'>
                <td width='90px' rowspan='2'>
                    <div style='width: 80px; height: 80px; margin: 4px 8px 4px 4px; border: 1px solid #4b3124; background-color: white'>
                        <img id="fdpwikipic" style='width: 80px; height: 80px' />
                    </div>
                </td>
                <td colspan=3 style='border-bottom: 1px solid #4b3124; padding: 4px 4px 4px 0px'>
                    <img style='float: right; padding: 4px' class="cbut" id="bedit" pic="bedit" title="Éditer" act="fdp()" />
                    <img style='float: right; padding: 4px' class="cbut" id="bbalise" pic="bbalise" title="Balise" act="balise()" />
                    <span style='font-size: 150%; font-weight: bold' id="fdpwikinom"> </span>
                </td>
            </tr>
            <tr style='padding: 3px 0 3px 0'>
                <td style='width: 25%; padding-left: 0; padding-right: 6px; border-right: 1px solid #4b3124' id="fdpwikicol1"></td>
                <td style='width: 15%; padding-left: 6px; padding-right: 6px; border-right: 1px solid #4b3124' id="fdpwikicol2"></td>
                <td style='width: 45%; padding-left: 6px; padding-right: 6px' id="fdpwikicol3"></td>
            </tr>
        </table>
    </div>

    <div id="tr_balise">
        <table cellspacing=0 cellpadding=4 class="tabletop">
            <tr>
                <td>
                    <input type="text" id="baltext" style="width: 100%"></input><br />
                    <table width="100%">
                        <tr>
                            <td style="vertical-align:top">
                                <input type="checkbox" id="ballienimage" checked /> Lien sur l'image <br />
                                <input type="checkbox" id="balaffichernom" checked /> Nom du personnage<br />
                                <input type="checkbox" id="balafficherpv" checked /> Points de vie<br />
                            </td>
                            <td style="vertical-align:top">
                                <input type="radio" name="balalign" id="balaligng" value="gauche" selected /> Aligné à gauche <br />
                                <input type="radio" name="balalign" id="balalignd" value="droite" /> Aligné à droite <br />
                            </td>
                            <td style="vertical-align:top">
                                <button id="balise_actualiser" onclick="balise_actualiser();">Actualiser</button>
                            </td>
                        </tr>
                    </table>
                    <p>
                        Couleur du nom : <input type="text" id="balcoulnom" /> sur <input type="text" id="balcoulsur" /> <br />
                        <i>Laisser vide pour les couleurs par défaut</i>
                    </p>
                </td>
            </tr>
        </table>
    </div>

    <div id="maintarget"></div>

    <script>
        function balise_actualiser() {
            var bal = "[jeton";
            if ($("#balaligng").attr("checked"))
                bal += "g";
            else
                bal += "d";
            if ($("#ballienimage").attr("checked"))
                bal += '!a:' + document.referrer;
            if ($("#balaffichernom").attr("checked")) {
                bal += '=';
                if ($("#balcoulnom").val() != '') {
                    bal += '[st=' + $("#balcoulnom").val();
                    if ($("#balcoulsur").val() != '')
                        bal += '/' + $("#balcoulsur").val();
                    bal += "]"
                }
                bal += p.nom;
                if ($("#balcoulnom").val() != '')
                    bal += "[/st]";
            }
            if ($("#balafficherpv").attr("checked"))
                bal += "!p:" + p.pv + "/" + p.pvmax;
            bal += ']' + p.img;
            bal += "[/jeton]";
            $("#baltext").val(bal);
        }

        $("#tr_balise").hide()
        initfdp();
        affichewiki();
        $(".cbut").each(function () { initbutton(this, 20); });


        function initbutton(el, tai) {
            $(el).attr("src", "Boutons/" + $(el).attr("pic") + ".jpg");
            $(el).css("width", "" + tai + "px");
            $(el).css("padding", "2px");
            if ($(el).attr("id") != "bgrille") {
                $(el).mouseover(function () { $(el).css("padding", "0px"); $(el).css("border", "2px solid #e7dfc6"); });
                $(el).mouseout(function () { $(el).css("padding", "2px"); $(el).css("border", "0"); });
            }
            if ($(el).attr("act"))
                $(el).click(new Function($(el).attr("act")));
            $(el).css("padding", "2px");
            $(el).css("border", "0");
        }

        function initfdp() {
            initconstfdp();
            p = new perso();
            tabc = "#f3efe2";
            tafs = "90";
            var pdesc = window.parent.pdesc;
            pdesc = pdesc.replace(/00LBR00/g, "\u005b").replace(/00RBR00/g, "\u005d").replace(/00GUI00/g, "'").replace(/00LCB00/g, "{");
            if (pdesc != "")
                p = JSON.parse(pdesc);
            if (!p.showcomp) p.showcomp = "1";
            if (!p.showmagie) p.showmagie = "1";
            if (!p.showmagempty) p.showmagempty = "1";
            tastyle = " style='font-family: monospace; width: 100%; background-color: " + tabc + "; font-size: " + tafs + "%' ";
            commpre = "<span style='color: gray; font-style: italic'>";
            commpost = "</span>";
        }
        function initconstfdp() {
            /* Compétences */
            ctab = ["I2Acrobaties!Acrobaties", "4Art de la magie!Art de la magie", "I4*Artis!Artisanat", "I4*Artis!Artisanat", "I6Bluff!Bluff",
              "4Conn (donjons)!Connaissances", "4Conn (géographie)!Connaissances", "4Conn (histoire)!Connaissances",
              "4Conn (ingénierie)!Connaissances", "4Conn (local)!Connaissances", "4Conn (mystères)!Connaissances", "4Conn (nature)!Connaissances",
              "4Conn (noblesse)!Connaissances", "4Conn (plans)!Connaissances", "4Conn (religion)!Connaissances", "4*Conn!Connaissances",
              "4*Conn!Connaissances", "I6Déguisement!Déguisement", "2Désamorçage!Sabotage", "I6Diplomatie!Diplomatie", "I2Discrétion!Discrétion",
              "6Dressage!Dressage", "I2Équitation!Équitation", "I1Escalade!Escalade", "2Escamotage!Escamotage", "I4Estimation!Estimation",
              "I2Évasion!Évasion", "I6Intimidation!Intimidation", "4Linguistique!Linguistique", "I1Natation!Natation", "I5Perception!Perception",
              "I5Premiers secours!Premiers secours", "5*Prof!Profession", "5*Prof!Profession", "I5Psychologie!Psychologie",
              "I6*Repr!Représentation", "I6*Repr!Représentation", "I6*Repr!Représentation", "I6*Repr!Représentation", "I5Survie!Survie",
              "6Utilisation d'OM!Utilisation dobjets magiques", "I2Vol!Vol"];
            cl = ctab.length;
            classestab = ["Alchimiste", "Barbare", "Barde", "Chevalier", "Conjurateur", "Druide", "Ensorceleur", "Guerrier", "Inquisiteur",
              "Magicien", "Moine", "Oracle", "Paladin", "Prêtre", "Rôdeur", "Roublard", "Sorcière"];
            compclasse = new Array();
            compclasse["Alchimiste"] = [1, 2, 3, 10, 11, 18, 24, 25, 30, 31, 32, 33, 39, 40, 41];
            compclasse["Barbare"] = [0, 2, 3, 11, 21, 22, 23, 27, 29, 30, 39];
            compclasse["Barde"] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19, 20, 23, 24, 25, 26, 27, 28, 30, 32, 33, 34, 35, 36, 37, 38, 40];
            compclasse["Chevalier"] = [2, 3, 4, 19, 21, 22, 23, 27, 29, 32, 33, 34];
            compclasse["Conjurateur"] = [1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 21, 22, 28, 32, 33, 40, 41];
            compclasse["Druide"] = [1, 2, 3, 6, 11, 21, 22, 23, 29, 30, 31, 32, 33, 39, 41];
            compclasse["Ensorceleur"] = [1, 2, 3, 4, 10, 25, 27, 32, 33, 40, 41];
            compclasse["Guerrier"] = [2, 3, 5, 8, 21, 22, 23, 27, 29, 32, 33, 39];
            compclasse["Inquisiteur"] = [1, 2, 3, 4, 5, 10, 11, 13, 14, 17, 19, 20, 22, 23, 27, 29, 30, 31, 32, 33, 34, 39];
            compclasse["Magicien"] = [1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 25, 28, 32, 33, 41];
            compclasse["Moine"] = [0, 2, 3, 7, 14, 20, 22, 23, 26, 27, 29, 30, 32, 33, 34, 35, 36, 37, 38];
            compclasse["Oracle"] = [1, 2, 3, 7, 13, 14, 19, 31, 32, 33, 34];
            compclasse["Paladin"] = [1, 2, 3, 12, 14, 19, 21, 22, 31, 32, 33, 34];
            compclasse["Prêtre"] = [1, 2, 3, 7, 10, 12, 13, 14, 19, 25, 28, 31, 32, 33, 34];
            compclasse["Rôdeur"] = [1, 2, 3, 5, 6, 11, 20, 21, 22, 23, 27, 29, 30, 31, 32, 33, 39];
            compclasse["Roublard"] = [0, 2, 3, 4, 5, 9, 17, 18, 19, 20, 23, 24, 25, 26, 27, 28, 29, 30, 32, 33, 34, 35, 36, 37, 38, 40];
            compclasse["Sorcière"] = [1, 2, 3, 7, 10, 11, 13, 27, 31, 32, 33, 40, 41];
            /* Langues */
            lgtab = ["*Races", "Commun", "Elfique", "Gnome", "Halfling", "Nain", "*Classes", "Druidique", "*Monstres", "Draconique", "Géant",
              "Gnoll", "Gobelin", "Orque", "Profondeurs", "Sylvestre", "*Extérieurs", "Abyssal", "Aérien", "Aquatique", "Céleste", "Igneux",
              "Infernal", "Terreux"];
            lgl = lgtab.length;
            /* Emplacements d'objets portés */
            ptab = ["*Sur la tête", "Tête", "Front", "Yeux", "*Bras et mains", "Poignets", "Mains", "Anneau", "Anneau", "*Vêtements", "Épaules",
              "Corps", "Torse", "*Autre", "Cou", "Taille", "Pieds", "*Armure et bouclier", "Armure", "Bouclier"];
            pl = ptab.length;
            /* Charges */
            chmoytab = [1.5, 3, 5, 6.5, 8, 10, 11.5, 13, 15, 17.5, 19, 21.5, 25, 29, 33, 38, 43, 50, 58, 66.5, 76.5, 86.5, 100, 116.5, 133, 153, 173, 200, 233];
            chloutab = [3, 6.5, 10, 13, 16.5, 20, 23, 26.5, 30, 33, 38, 43, 50, 58, 66.5, 76.5, 86.5, 100, 116.5, 133, 153, 173, 200, 233, 266.5, 306.5, 346.5, 400, 466.5];
            chmaxtab = [5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 57.5, 65, 75, 87.5, 100, 115, 130, 150, 175, 200, 230, 260, 300, 350, 400, 460, 520, 600, 700];
            /* Modificateurs de taille */
            chmodtailletab = [16.0, 8.0, 4.0, 2.0, 1.0, 0.75, 0.5, 0.25, 0.125];
        }
        function balise() {
            $("#tr_balise").toggle()
        }
        function fdp() {
            fen = window.open('FDP.html', p.nom, 'scrollbars=yes,height=750,width=900,resizable=yes,directories=no,location=no,menubar=no,status=no,left=50,top=50');
            fen.onload = function () {
                doc = fen.document;
                main = doc.getElementById("main");
                doc.getElementById("bIdent").onclick = bIdent;
                doc.getElementById("bCombat").onclick = bCombat;
                doc.getElementById("bCapac").onclick = bCapac;
                doc.getElementById("bComp").onclick = bComp;
                doc.getElementById("bMagie").onclick = bMagie;
                doc.getElementById("bEquip").onclick = bEquip;
                doc.getElementById("bCompa").onclick = bCompa;
                doc.getElementById("bNotes").onclick = bNotes;
                doc.getElementById("bCode").onclick = bCode;
                doc.getElementById("bWiki").onclick = new Function("window.open('http://www.pathfinder-fr.org/Wiki/Pathfinder-RPG.MainPage.ashx','Wiki','scrollbars=yes,resizable=yes,directories=no,location=yes,menubar=yes,status=yes,left=50,top=50');");
                affiche = 0;
                bIdent();
            }
        }
        function bwiki(url) {
            return ("<img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/BoutonW.jpg' id='bwikilink' width='8px' style='margin-left: 2px; margin-bottom: 2px; padding-bottom: 2px' name='" + url + "'/>");
        }
        function bwikiset() {
            var tab = doc.images;
            for (var i = 0; i < tab.length; i++) {
                var img = arrayget(tab, i);
                if (img.id == 'bwikilink') {
                    var zurl = img.name;
                    if (zurl.substring(0, 1) == "!")
                        zurl = zurl.substring(1);
                    else
                        zurl = "http://www.pathfinder-fr.org/Wiki/" + zurl;
                    img.onclick = new Function("window.open('" + zurl + "','wiki','scrollbars=yes,resizable=yes,directories=no,location=no,menubar=no,status=no,left=50,top=50');");
                }
            }
        }
        function bIdent() {
            if (!p.ctaille)
                p.ctaille = "4";
            sauve();
            vide(main);
            affiche = 1;
            main.style.border = "1px solid #3b3124";
            var contenu = "<table width='100%'><tr><td>";
            contenu += "<table width='100%'>";
            contenu += "<tr><td colspan='3' style='border: 1px solid #4b3124'>";
            contenu += "<table width='100%'>";
            contenu += "<tr style='vertical-align: center'>";
            contenu += "<td width='100px'><img id='idimg' src='' style='width:90px; border: 1px solid #f3efe2; background-color: #f3efe2'/></td>";
            contenu += "<td align='center'>";
            contenu += "<table width='100%'>";
            contenu += "<tr><td>Nom</td><td><input id='idnom' type='text' size='38'/></td></tr>";
            contenu += "<tr><td>Race/Ethnie</td><td><input id='idrace' type='text' size='38'/></td></tr>";
            contenu += "<tr><td>Sexe</td><td><input id='idsexe' type='text' size='38'/></td></tr>";
            contenu += "<tr><td>Ctg taille</td><td><select id='idctaille'>";
            contenu += "<option>Colossal (C)</option>";
            contenu += "<option>Gigantesque (Gig)</option>";
            contenu += "<option>Très grand (TG)</option>";
            contenu += "<option>Grand (G)</option>";
            contenu += "<option>Moyen (M)</option>";
            contenu += "<option>Petit (P)</option>";
            contenu += "<option>Très Petit (TP)</option>";
            contenu += "<option>Minuscule (Min)</option>";
            contenu += "<option>Infime (I)</option>";
            contenu += "</select></td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td align='right'>";
            contenu += "<table width='100%'>";
            contenu += "<tr><td>Joueur</td><td><input id='idjoueur' type='text' size='38'/></td></tr>";
            contenu += "<tr><td>MD</td><td><input id='idmd' type='text' size='38'/></td></tr>";
            contenu += "<tr><td>Partie</td><td><input id='idpartie' type='text' size='38'/></td></tr>";
            contenu += "<tr><td colspan='2' style='font-size:75%'><i>Cliquer sur l'image à gauche pour la modifier.</i></td></tr>";
            contenu += "</table>";
            contenu += "</td></tr></table>";
            contenu += "</td></tr>"
            contenu += "<tr><td padding='2px'></td></tr>";
            contenu += "<tr style='vertical-align: center'><td width='66%' style='border: 1px solid #4b3124'>";
            contenu += "<table width='100%'>";
            contenu += "<tr><td>Classes & niveaux" + bwiki("Pathfinder-RPG.Classes.ashx") + "</td><td><input id='idclasses' type='text' size='60'/></td></tr>";
            contenu += "<tr><td>Cls de prédilection</td><td><input id='idcdp' type='text' size='60'/></td></tr>";
            contenu += "<tr><td padding='2px'></td></tr>";
            contenu += "</table>";
            contenu += "<table width='100%'><tr style='vertical-align: top'><td width='50%'>";
            contenu += "<table width='100%'>";
            contenu += "<tr><td>Origine</td><td><input id='idorigine' type='text' size='25'/></td></tr>";
            contenu += "<tr><td>Religion</td><td><input id='idreligion' type='text' size='25'/></td></tr>";
            contenu += "<tr><td padding='3px'></td></tr>";
            contenu += "<tr><td>Âge" + bwiki("Pathfinder-RPG.%C3%89tat%20civil%20et%20mensurations.ashx#AGE") + "</td><td><input id='idage' type='text' size='25'/></td></tr>";
            contenu += "<tr><td>Poids" + bwiki("Pathfinder-RPG.%C3%89tat%20civil%20et%20mensurations.ashx#TAILLEPOIDS") + "</td><td><input id='idpoids' type='text' size='25'/></td></tr>";
            contenu += "<tr><td>Taille" + bwiki("Pathfinder-RPG.%C3%89tat%20civil%20et%20mensurations.ashx#TAILLEPOIDS") + "</td><td><input id='idtaille' type='text' size='25'/></td></tr>";
            contenu += "</table>";
            contenu += "</td><td width='50%'>";
            contenu += "<table width='100%'>";
            contenu += "<tr><td>Alignement" + bwiki("Pathfinder-RPG.Alignement.ashx") + "</td><td><input id='idalign' type='text' size='25'/></td></tr>";
            contenu += "<tr><td>Dextrie</td><td><input id='iddextrie' type='text' size='25'/></td></tr>";
            contenu += "<tr><td padding='3px'></td></tr>";
            contenu += "<tr><td>Yeux</td><td><input id='idyeux' type='text' size='25'/></td></tr>";
            contenu += "<tr><td>Cheveux</td><td><input id='idcheveux' type='text' size='25'/></td></tr>";
            contenu += "<tr><td>Peau</td><td><input id='idpeau' type='text' size='25'/></td></tr>";
            contenu += "</table>";
            contenu += "</td></tr></table>";
            contenu += "</td><td width='1%'></td>";
            contenu += "<td width='33%' align='center' style='border: 1px solid #4b3124'>";
            contenu += "<table>";
            contenu += "<tr><td></td><td rowspan='13'>&nbsp;</td><td align='center'>Base</td><td></td>";
            contenu += "<td rowspan='13'>&nbsp;</td><td align='center'>Actuel</td><td></td></tr>";
            var stlist = "FOR,DEX,CON,INT,SAG,CHA";
            var urllist = "Force,Dextérité,Constitution,Intelligence,Sagesse,Charisme";
            var sttab = stlist.split(",");
            var urltab = urllist.split(",");
            for (var i = 0; i < 6; i++) {
                contenu += "<tr><td colspan='5' padding: '1px'></td></tr>";
                contenu += "<tr><td style='font-size: 100%'>" + arrayget(sttab, i);
                contenu += bwiki("Pathfinder-RPG." + arrayget(urltab, i) + ".ashx") + "</td>";
                contenu += "<td id='idbase" + i + "' align='center' style='font-size: 120%'></td>";
                contenu += butpm("bb+" + i, "bb-" + i);
                contenu += "<td id='id" + i + "' align='center' style='font-size: 120%'></td>";
                contenu += butpme("b+" + i, "b-" + i, "b=" + i);
                contenu += "</tr>";
            }
            contenu += "</table>";
            contenu += "</td></tr>";
            contenu += "<tr><td colspan='3'><i style='font-size: 85%'>Notes</i></td></tr>";
            contenu += "<tr><td colspan='3'><textarea rows='18'" + tastyle + "id = 'idnoteidentité'></textarea></td></tr></table>";
            main.innerHTML = contenu;
            bwikiset();
            doc.getElementById("idimg").src = p.img;
            doc.getElementById("idimg").onclick = modimg;
            doc.getElementById("idnom").value = p.nom;
            doc.getElementById("idrace").value = p.race;
            doc.getElementById("idsexe").value = p.sexe;
            doc.getElementById("idctaille").selectedIndex = parseInt(p.ctaille);
            doc.getElementById("idjoueur").value = p.joueur;
            doc.getElementById("idmd").value = p.md;
            doc.getElementById("idpartie").value = p.partie;
            doc.getElementById("idclasses").value = p.classes;
            doc.getElementById("idcdp").value = p.cdp;
            doc.getElementById("idreligion").value = p.religion;
            doc.getElementById("idorigine").value = p.origine;
            doc.getElementById("idalign").value = p.align;
            doc.getElementById("idage").value = p.age;
            doc.getElementById("iddextrie").value = p.dextrie;
            doc.getElementById("idpoids").value = p.poids;
            doc.getElementById("idtaille").value = p.taille;
            doc.getElementById("idyeux").value = p.yeux;
            doc.getElementById("idcheveux").value = p.cheveux;
            doc.getElementById("idpeau").value = p.peau;
            doc.getElementById("idnoteidentité").value = p.noteidentité;
            setstats();
            for (var i = 0; i < 6; i++) {
                var stblist = "forbase,dexbase,conbase,intbase,sagbase,chabase";
                var stlist = "force,dex,con,int,sag,cha";
                var stbtab = stblist.split(",");
                var sttab = stlist.split(",");
                doc.getElementById("bb+" + i).onclick = new Function("p." + arrayget(stbtab, i) + "++; setstats();");
                doc.getElementById("bb-" + i).onclick = new Function("p." + arrayget(stbtab, i) + "--; setstats();");
                doc.getElementById("b+" + i).onclick = new Function("p." + arrayget(sttab, i) + "++; setstats();");
                doc.getElementById("b-" + i).onclick = new Function("p." + arrayget(sttab, i) + "--; setstats();");
                doc.getElementById("b=" + i).onclick = new Function("p." + arrayget(sttab, i) + "=p." + arrayget(stbtab, i) + "; setstats();");
            }
        }
        function modimg() {
            var nsrc = fen.prompt("Entrez l'adresse de la nouvelle image.", p.img);
            if (nsrc != null) {
                p.img = nsrc;
                doc.getElementById("idimg").src = nsrc;
            }
        }
        function setstats() {
            doc.getElementById("idbase0").innerHTML = statecho(p.forbase);
            doc.getElementById("idbase1").innerHTML = statecho(p.dexbase);
            doc.getElementById("idbase2").innerHTML = statecho(p.conbase);
            doc.getElementById("idbase3").innerHTML = statecho(p.intbase);
            doc.getElementById("idbase4").innerHTML = statecho(p.sagbase);
            doc.getElementById("idbase5").innerHTML = statecho(p.chabase);
            doc.getElementById("id0").innerHTML = statecho(p.force);
            doc.getElementById("id1").innerHTML = statecho(p.dex);
            doc.getElementById("id2").innerHTML = statecho(p.con);
            doc.getElementById("id3").innerHTML = statecho(p.int);
            doc.getElementById("id4").innerHTML = statecho(p.sag);
            doc.getElementById("id5").innerHTML = statecho(p.cha);
        }
        function bCombat() {
            sauve();
            vide(main);
            affiche = 2;
            main.style.border = "1px solid #3b3124";
            var contenu = "<table width='100%'><tr><td>";
            contenu += "<table width='100%'><tr>";
            contenu += "<td width='33%'>";
            contenu += "<i style='font-size: 85%'>Exploration</i><br/>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>Init" + bwiki("Pathfinder-RPG.Déroulement dun combat.ashx#INITIATIVE") + "</td>";
            contenu += "<td style='font-weight:bold' align='center' id='idinit'>+0</td>";
            contenu += "<td>=</td>";
            contenu += "<td style='color:gray; font-size: 80%' id='idinitmod'></td>";
            contenu += "<td align='center' id='idinitdiv'>+0</td>";
            contenu += butpm("init+", "init-");
            contenu += "<td><input type='text' size='8' id='idinitnote'/></td>";
            contenu += "</tr>";
            contenu += "<tr><td>VD" + bwiki("Pathfinder-RPG.Valeurs de combat.ashx#VITESSEDEDEPLACEMENT") + "</td><td colspan='6'><input type='text' id='idvd' size='28'/></td></tr>";
            contenu += "<tr><td>Vision" + bwiki("Pathfinder-RPG.Exploration.ashx#VISIONLUMIERE") + "</td><td colspan='6'><input type='text' id='idvision' size='28'/></td></tr>";
            contenu += "<tr><td colspan='8'><textarea rows='6'" + tastyle + "id = 'idnotesexplo'></textarea></td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='33%'>";
            contenu += "<i style='font-size: 85%'>Jets de sauvegarde</i>" + bwiki("Pathfinder-RPG.Valeurs de combat.ashx#JETDESAUVEGARDE") + "<br/>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>Réf</td>";
            contenu += "<td style='font-weight:bold' align='center' id='idreftot'>+0</td><td>=</td>";
            contenu += "<td align='center' id='idrefbase'>0</td>";
            contenu += butpm("refbase+", "refbase-");
            contenu += "<td style='color:gray; font-size: 80%' id='idrefmod'></td>";
            contenu += "<td align='center' id='idrefdiv'>+0</td>";
            contenu += butpm("refdiv+", "refdiv-");
            contenu += "<td><input type='text' size='8' id='idrefnote'/></td>";
            contenu += "</tr>";
            contenu += "<tr><td>Vig</td>";
            contenu += "<td style='font-weight:bold' align='center' id='idvigtot'>+0</td><td>=</td>";
            contenu += "<td align='center' id='idvigbase'>0</td>";
            contenu += butpm("vigbase+", "vigbase-");
            contenu += "<td style='color:gray; font-size: 80%' id='idvigmod'></td>";
            contenu += "<td align='center' id='idvigdiv'>+0</td>";
            contenu += butpm("vigdiv+", "vigdiv-");
            contenu += "<td><input type='text' size='8' id='idvignote'/></td>";
            contenu += "</tr>";
            contenu += "<tr><td>Vol</td>";
            contenu += "<td style='font-weight:bold' align='center' id='idvoltot'>+0</td><td>=</td>";
            contenu += "<td align='center' id='idvolbase'>0</td>";
            contenu += butpm("volbase+", "volbase-");
            contenu += "<td style='color:gray; font-size: 80%' id='idvolmod'></td>";
            contenu += "<td align='center' id='idvoldiv'>+0</td>";
            contenu += butpm("voldiv+", "voldiv-");
            contenu += "<td><input type='text' size='8' id='idvolnote'/></td>";
            contenu += "</tr>";
            contenu += "<tr><td colspan='9'><textarea rows='6'" + tastyle + "id = 'idnotesjds'></textarea></td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='32%'>";
            contenu += "<i style='font-size: 85%'>Points de vie</i><br/>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>pv</td><td colspan='5'><input type='text' id='idpv' size='25'/></td></tr>";
            contenu += "<tr><td>pv max</td><td colspan='5'><input type='text' id='idpvmax' size='25'/></td></tr>";
            contenu += "<tr><td>Non létal</td><td colspan='5'><input type='text' id='iddgnl' size='25'/></td></tr>";
            contenu += "<tr><td colspan='8'><textarea rows='6'" + tastyle + "id = 'idnotespv'></textarea></td></tr>";
            contenu += "</table>";
            contenu += "</td></tr>";
            contenu += "<tr><td>";
            contenu += "<i style='font-size: 85%'>Valeurs de combat</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>BBA" + bwiki("Pathfinder-RPG.Valeurs de combat.ashx#BONUSDATTAQUE") + "</td>";
            contenu += "<td><table><tr>"
            contenu += butpm("bba+", "bba-");
            contenu += "<td id='idbba' align='center'></td></tr></table>";
            contenu += "</td></tr>";
            contenu += "<tr><td colspan='2' id='idbbacomment' style='color: grey; font-size: 85%; font-style: italic'></td></tr>";
            contenu += "<tr><td>BMO" + bwiki("Pathfinder-RPG.Manuvres offensives.ashx") + "</td><td><input type='text' id='idbmo' size='25'/></td></tr>";
            contenu += "<tr><td>CA" + bwiki("Pathfinder-RPG.Valeurs de combat.ashx#CA") + "</td><td><input type='text' id='idca' size='25'/></td></tr>";
            contenu += "<tr><td>CA contact</td><td><input type='text' id='idcacontact' size='25'/></td></tr>";
            contenu += "<tr><td>CA surpris</td><td><input type='text' id='idcasurpris' size='25'/></td></tr>";
            contenu += "<tr><td>DMD" + bwiki("Pathfinder-RPG.Manuvres offensives.ashx") + "</td><td><input type='text' id='iddmd' size='25'/></td></tr>";
            contenu += "<tr><td colspan='2'><textarea rows='6'" + tastyle + "id = 'idnotescombat'></textarea></td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td></td>";
            contenu += "<td colspan='3'>";
            contenu += "<i style='font-size: 85%'>Armes et modes d'attaque</i>" + bwiki("Pathfinder-RPG.Tableau%20r%c3%a9capitulatif%20des%20armes.ashx");
            contenu += "<textarea rows='19'" + tastyle + "id = 'idarmes'></textarea>";
            contenu += "</td></tr>";
            contenu += "<tr><td colspan='5'><textarea rows='6'" + tastyle + "id = 'idnotescombat2'></textarea></td></tr>";
            contenu += "</table>";
            contenu += "</td></tr></table>";
            main.innerHTML = contenu;
            bwikiset();
            doc.getElementById("idinitnote").value = p.initnote;
            doc.getElementById("idvd").value = p.vd;
            doc.getElementById("idvision").value = p.vision;
            doc.getElementById("idnotesexplo").value = p.notesexplo;
            doc.getElementById("init+").onclick = new Function("p.initdiv = modif(p.initdiv,1); majCombat();");
            doc.getElementById("init-").onclick = new Function("p.initdiv = modif(p.initdiv,-1); majCombat();");
            doc.getElementById("idrefnote").value = p.refnote;
            doc.getElementById("idvignote").value = p.vignote;
            doc.getElementById("idvolnote").value = p.volnote;
            doc.getElementById("idnotesjds").value = p.notesjds;
            doc.getElementById("refbase+").onclick = new Function("p.refbase = modif(p.refbase,1); majCombat();");
            doc.getElementById("refbase-").onclick = new Function("p.refbase = modif(p.refbase,-1); majCombat();");
            doc.getElementById("refdiv+").onclick = new Function("p.refdiv = modif(p.refdiv,1); majCombat();");
            doc.getElementById("refdiv-").onclick = new Function("p.refdiv = modif(p.refdiv,-1); majCombat();");
            doc.getElementById("vigbase+").onclick = new Function("p.vigbase = modif(p.vigbase,1); majCombat();");
            doc.getElementById("vigbase-").onclick = new Function("p.vigbase = modif(p.vigbase,-1); majCombat();");
            doc.getElementById("vigdiv+").onclick = new Function("p.vigdiv = modif(p.vigdiv,1); majCombat();");
            doc.getElementById("vigdiv-").onclick = new Function("p.vigdiv = modif(p.vigdiv,-1); majCombat();");
            doc.getElementById("volbase+").onclick = new Function("p.volbase = modif(p.volbase,1); majCombat();");
            doc.getElementById("volbase-").onclick = new Function("p.volbase = modif(p.volbase,-1); majCombat();");
            doc.getElementById("voldiv+").onclick = new Function("p.voldiv = modif(p.voldiv,1); majCombat();");
            doc.getElementById("voldiv-").onclick = new Function("p.voldiv = modif(p.voldiv,-1); majCombat();");
            doc.getElementById("idpv").value = p.pv;
            doc.getElementById("idpvmax").value = p.pvmax;
            doc.getElementById("iddgnl").value = p.dgnl;
            doc.getElementById("idnotespv").value = p.notespv;
            doc.getElementById("bba+").onclick = new Function("p.bba = modif(p.bba,1); majCombat();");
            doc.getElementById("bba-").onclick = new Function("p.bba = modif(p.bba,-1); majCombat();");
            doc.getElementById("idbmo").value = p.bmo;
            doc.getElementById("iddmd").value = p.dmd;
            doc.getElementById("idca").value = p.ca;
            doc.getElementById("idcasurpris").value = p.casurpris;
            doc.getElementById("idcacontact").value = p.cacontact;
            doc.getElementById("idnotescombat").value = p.notescombat;
            doc.getElementById("idnotescombat2").value = p.notescombat2;
            doc.getElementById("idarmes").value = p.armes;
            majCombat();
        }
        function majCombat() {
            var val = 0;
            doc.getElementById("idinitmod").innerHTML = statmodecho(p.dex) + " Dex";
            doc.getElementById("idinitdiv").innerHTML = zaffiche(parseInt(p.initdiv));
            val = parseInt(p.initdiv) + statmod(p.dex);
            doc.getElementById("idinit").innerHTML = zaffiche(val);
            doc.getElementById("idrefbase").innerHTML = zaffiche(parseInt(p.refbase));
            doc.getElementById("idrefdiv").innerHTML = zaffiche(parseInt(p.refdiv));
            doc.getElementById("idrefmod").innerHTML = statmodecho(p.dex) + " Dex";
            val = parseInt(p.refbase) + parseInt(p.refdiv) + statmod(p.dex);
            doc.getElementById("idreftot").innerHTML = zaffiche(val);
            doc.getElementById("idvigbase").innerHTML = zaffiche(parseInt(p.vigbase));
            doc.getElementById("idvigdiv").innerHTML = zaffiche(parseInt(p.vigdiv));
            doc.getElementById("idvigmod").innerHTML = statmodecho(p.con) + " Con";
            val = parseInt(p.vigbase) + parseInt(p.vigdiv) + statmod(p.con);
            doc.getElementById("idvigtot").innerHTML = zaffiche(val);
            doc.getElementById("idvolbase").innerHTML = zaffiche(parseInt(p.volbase));
            doc.getElementById("idvoldiv").innerHTML = zaffiche(parseInt(p.voldiv));
            doc.getElementById("idvolmod").innerHTML = statmodecho(p.sag) + " Sag";
            val = parseInt(p.volbase) + parseInt(p.voldiv) + statmod(p.sag);
            doc.getElementById("idvoltot").innerHTML = zaffiche(val);
            var bba = parseInt(p.bba);
            var mfor = statmod(p.force);
            var mdex = statmod(p.dex);
            var ct = parseInt(p.ctaille);
            var modtai = 0;
            if (ct == 0) modtai = -8;
            if (ct == 1) modtai = -4;
            if (ct == 2) modtai = -2;
            if (ct == 3) modtai = -1;
            if (ct == 5) modtai = 1;
            if (ct == 6) modtai = 2;
            if (ct == 7) modtai = 4;
            if (ct == 8) modtai = 8;
            var tbba = "";
            var tcac = "";
            var tdist = "";
            while (bba > 5) {
                tbba += "/" + zaffiche(bba);
                tcac += "/" + zaffiche(bba + mfor + modtai);
                tdist += "/" + zaffiche(bba + mdex + modtai);
                bba -= 5;
            }
            tbba += "/" + zaffiche(bba);
            tcac += "/" + zaffiche(bba + mfor + modtai);
            tdist += "/" + zaffiche(bba + mdex + modtai);
            doc.getElementById("idbba").innerHTML = tbba.substring(1);
            doc.getElementById("idbbacomment").innerHTML = "Càc : " + tcac.substring(1) + " ; Dist : " + tdist.substring(1);
        }
        function bCapac() {
            sauve();
            vide(main);
            affiche = 3;
            main.style.border = "1px solid #3b3124";
            var contenu = "<table width='100%'><tr><td>";
            contenu += "<table width='100%'><tr style='vertical-align: top'>";
            contenu += "<td width='49%' rowspan='2'>";
            contenu += "<i style='font-size: 85%'>Traits et traits raciaux</i>";
            contenu += "<textarea rows='8'" + tastyle + "id = 'idtraits'></textarea>";
            contenu += "<i style='font-size: 85%'>Capacités de classe</i>";
            contenu += "<textarea rows='14'" + tastyle + "id = 'idcapacités'></textarea>";
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='50%'>";
            contenu += "<i style='font-size: 85%'>Compétences martiales</i>";
            contenu += "<textarea rows='8'" + tastyle + "id = 'idcpmartiales'></textarea>";
            contenu += "<i style='font-size: 85%'>Dons</i>" + bwiki("Pathfinder-RPG.tableau%20r%c3%a9capitulatif%20des%20dons.ashx");
            contenu += "<textarea rows='14'" + tastyle + "id = 'iddons'></textarea>";
            contenu += "</td>";
            contenu += "</tr></table>";
            contenu += "<table width='100%'>";
            contenu += "<tr>";
            contenu += "<td width='59%'><i style='font-size: 85%'>Langues</i></td>";
            contenu += "<td width='1%' rowspan='2'></td>";
            contenu += "<td width='40%'><i style='font-size: 85%'>Notes</i></td>";
            contenu += "</tr>";
            contenu += "<tr>";
            contenu += "<td style='border: 1px solid #4b3124'>";
            contenu += "<table width='100%'>";
            for (var i = 0; i < lgl / 3; i++) {
                contenu += "<tr>";
                var nom = arrayget(lgtab, i);
                var titre = (nom.substring(0, 1) == "*");
                if (titre) nom = nom.substring(1);
                if (titre)
                    contenu += "<td><b>" + nom + "</b></td>";
                else
                    contenu += "<td><input type='checkbox' id='idlgbox" + i + "'/> " + nom + "</td>";
                nom = arrayget(lgtab, i + lgl / 3);
                titre = (nom.substring(0, 1) == "*");
                if (titre) nom = nom.substring(1);
                if (titre)
                    contenu += "<td><b>" + nom + "</b></td>";
                else
                    contenu += "<td><input type='checkbox' id='idlgbox" + (i + lgl / 3) + "'/> " + nom + "</td>";
                nom = arrayget(lgtab, i + 2 * lgl / 3);
                titre = (nom.substring(0, 1) == "*");
                if (titre) nom = nom.substring(1);
                if (titre)
                    contenu += "<td><b>" + nom + "</b></td>";
                else
                    contenu += "<td><input type='checkbox' id='idlgbox" + (i + 2 * lgl / 3) + "'/> " + nom + "</td>";
                if (i == 0) {
                    contenu += "<td rowspan='" + lgl / 3 + "'>";
                    contenu += "<textarea rows='12'" + tastyle + "id = 'idlangues'></textarea></td>";
                }
                contenu += "</tr>";
            }
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td><textarea rows='13'" + tastyle + "id = 'idnotescapacités'></textarea></td>";
            contenu += "</tr></table>";
            contenu += "</td></tr></table>";
            main.innerHTML = contenu;
            bwikiset();
            doc.getElementById("idtraits").value = p.traits;
            doc.getElementById("idcpmartiales").value = p.cpmartiales;
            doc.getElementById("idcapacités").value = p.capacités;
            doc.getElementById("iddons").value = p.dons;
            doc.getElementById("idlangues").value = p.langues;
            doc.getElementById("idnotescapacités").value = p.notescapacités;
            for (var i = 0; i < lgl; i++) {
                var box = doc.getElementById("idlgbox" + i);
                if (box) {
                    if (arrayget(p.languesbool, i) == "1")
                        box.checked = "checked";
                    box.onclick = new Function("if (arrayget(p.languesbool," + i + ")=='0') arrayset(p.languesbool," + i + ",'1'); else arrayset(p.languesbool," + i + ",'0');");
                }
            }
        }
        function bComp() {
            sauve();
            vide(main);
            affiche = 4;
            main.style.border = "1px solid #3b3124";
            var contenu = "<table width='100%'><tr><td>";
            contenu += "<table width='100%'><tr><td width='49%'>";
            contenu += "<table width='100%' cellspacing='0px'>";
            contenu += "<tr style='font-size: 85%'>";
            contenu += "<td align='center'>Cc</td><td><i>Compétence</i></td><td align='center'>Tot</td><td></td><td colspan='2' align='center'>Rgs</td><td align='center'>Mod</td>";
            contenu += "<td colspan='3'>Divers</td></tr>";
            for (var i = 0; i < cl; i++) {
                if (i == cl / 2) {
                    contenu += "</table>";
                    contenu += "<td width='1%' style='border-right: 1px solid #4b3124'>&ensp;</td>";
                    contenu += "<td width='1%'>&ensp;</td>";
                    contenu += "<td width='49%'>";
                    contenu += "<table width='100%' cellspacing='0px'>";
                    contenu += "<tr><td align='center'>Cc</td><td><i>Compétence</i></td><td align='center'>Tot</td><td></td><td colspan='2' align='center'>Rgs</td><td align='center'>Mod</td>";
                    contenu += "<td colspan='3'>Divers</td></tr>";
                }
                var nom = arrayget(ctab, i);
                var inne = (nom.substring(0, 1) == "I");
                if (inne)
                    nom = nom.substring(2);
                else
                    nom = nom.substring(1);
                var ajout = (nom.substring(0, 1) == "*");
                if (ajout)
                    nom = nom.substring(1);
                var pos = nom.indexOf("!");
                var url = "Pathfinder-RPG." + nom.substring(pos + 1) + ".ashx";
                nom = nom.substring(0, pos);
                contenu += "<tr>";
                contenu += "<td align='center'><input type='checkbox' id='idcclabox" + i + "'/></td>";
                contenu += "<td style='font-size: 85%'>" + nom;
                if (ajout) contenu += " (<input id='idcnom" + i + "' type='text' size='8' value='" + arrayget(p.cnom, i) + "'/>)";
                contenu += bwiki(url) + "</td>";
                contenu += "<td style='font-weight:bold' align='center' id='idctot" + i + "'>+0</td><td>=</td>";
                contenu += "<td align='center' id='idcrangs" + i + "'>0</td>";
                contenu += butpm("bcrangs+" + i, "bcrangs-" + i);
                contenu += "<td style='color:gray; font-size: 80%' id='idcmod" + i + "'></td>";
                contenu += "<td align='center' id='idcdivers" + i + "'>+0</td>";
                contenu += butpm("bcdiv+" + i, "bcdiv-" + i);
                contenu += "<td><input type='text' size='8' id='idcnote" + i + "'/></td>";
                contenu += "</tr>";
            }
            contenu += "</table>";
            contenu += "</td></tr></table>";
            contenu += "</td></tr>";
            contenu += "<tr><td>";
            contenu += "<table width='100%'><tr>";
            contenu += "<td width='76%'>";
            contenu += "<i style='font-size: 85%'>Notes</i> <div id='rtot' style='float:right'>(nombre de rangs utilisés : 0)</div>";
            contenu += "<textarea rows='3'" + tastyle + "id = 'idnotescompétences'></textarea>";
            contenu += "</td>";
            contenu += "<td width='24%'><center>";
            contenu += "Ajouter des cpt de classe" + bwiki("Pathfinder-RPG.Tableau récapitulatif des compétences.ashx") + "<br/>";
            contenu += "<select id='choixclasse' size='1'>";
            for (var k = 0; k < classestab.length; k++)
                contenu += "<option>" + arrayget(classestab, k) + "</option>";
            contenu += "</select>&emsp;";
            contenu += "<button type='button' id='bajoutcc'>Ajouter</button><br/><br/>";
            contenu += "<small><i>(*) moins la pénalité d'armure</i></small>";
            contenu += "</center></td>";
            contenu += "</tr></table>";
            contenu += "</td></tr></table>";
            main.innerHTML = contenu;
            bwikiset();
            doc.getElementById("idnotescompétences").value = p.notescompétences;
            for (var i = 0; i < cl; i++) {
                doc.getElementById("idcnote" + i).value = arrayget(p.cnote, i);
                doc.getElementById("bcrangs+" + i).onclick = new Function("arrayset(p.crangs," + i + ",modif(arrayget(p.crangs," + i + "),1)); majCpt();");
                doc.getElementById("bcrangs-" + i).onclick = new Function("arrayset(p.crangs," + i + ",modif(arrayget(p.crangs," + i + "),-1)); majCpt();");
                doc.getElementById("bcdiv+" + i).onclick = new Function("arrayset(p.cdivers," + i + ",modif(arrayget(p.cdivers," + i + "),1)); majCpt();");
                doc.getElementById("bcdiv-" + i).onclick = new Function("arrayset(p.cdivers," + i + ",modif(arrayget(p.cdivers," + i + "),-1)); majCpt();");
                doc.getElementById("idcclabox" + i).onclick = new Function("if (arrayget(p.cclasse," + i + ")=='0') arrayset(p.cclasse," + i + ",'1'); else arrayset(p.cclasse," + i + ",'0'); majCpt();");
            }
            doc.getElementById("bajoutcc").onclick = ajoutcc;
            majCpt();
        }
        function ajoutcc() {
            var classe = doc.getElementById("choixclasse").value;
            var aj = compclasse[classe];
            if (fen.confirm("Voulez-vous ajouter comme compétences de classe toutes les compétences du " + classe + " ?"))
                for (var i = 0; i < aj.length; i++)
                    arrayset(p.cclasse, arrayget(aj, i), "1");
            majCpt();
        }
        function majCpt() {
            var totr = 0;
            for (var i = 0; i < cl; i++) {
                var nom = arrayget(ctab, i);
                var inne = (nom.substring(0, 1) == "I");
                if (inne) nom = nom.substring(1);
                var stat = parseInt(nom.substring(0, 1));
                var tot = 0;
                doc.getElementById("idcrangs" + i).innerHTML = arrayget(p.crangs, i);
                tot += parseInt(arrayget(p.crangs, i));
                var entraine = (tot > 0);
                totr += tot;
                var contenu = "";
                switch (stat) {
                    case 1:
                        contenu += statmodecho(p.force) + " For";
                        tot += statmod(p.force);
                        break;
                    case 2:
                        contenu += statmodecho(p.dex) + " Dex";
                        tot += statmod(p.dex);
                        break;
                    case 3:
                        contenu += statmodecho(p.con) + " Con";
                        tot += statmod(p.con);
                        break;
                    case 4:
                        contenu += statmodecho(p.int) + " Int";
                        tot += statmod(p.int);
                        break;
                    case 5:
                        contenu += statmodecho(p.sag) + " Sag";
                        tot += statmod(p.sag);
                        break;
                    case 6:
                        contenu += statmodecho(p.cha) + " Cha";
                        tot += statmod(p.cha);
                        break;
                    default:
                        contenu += "???";
                        break;
                }
                if ((arrayget(p.cclasse, i) == "1") && entraine) {
                    contenu += " +3";
                    tot += 3;
                }
                if (arrayget(p.cclasse, i) == "1")
                    doc.getElementById("idcclabox" + i).checked = "checked";
                doc.getElementById("idcmod" + i).innerHTML = contenu;
                doc.getElementById("idcdivers" + i).innerHTML = zaffiche(parseInt(arrayget(p.cdivers, i)));
                tot += parseInt(arrayget(p.cdivers, i));
                var util = inne || entraine;
                doc.getElementById("idctot" + i).innerHTML = (util ? "" : "(") + zaffiche(tot) + (util ? "" : ")") + ((stat == 1) || (stat == 2) ? "*" : "");
            }
            doc.getElementById("rtot").innerHTML = "(nombre de rangs utilisés : " + totr + ")";
        }
        function bMagie() {
            if (!p.surl) {
                p.surl = new Array(500);
                for (var i = 0; i < 500; i++)
                    arrayset(p.surl, i, "");
            }
            sauve();
            vide(main);
            affiche = 5;
            main.style.border = "1px solid #3b3124";
            var contenu = "<table width='100%'><tr><td>";
            contenu += "<table width='100%'><tr>";
            contenu += "<td width='35%'>";
            contenu += "<i style='font-size: 85%'>Sorts par niveau" + bwiki("Pathfinder-RPG.Caract%C3%A9ristiques.ashx#DETERMINERLESMODIFICATEURS") + "</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td align='center'>Niv</td><td align='center'>DD</td><td align='center'>par jour</td>";
            contenu += "<td align='center'>P</td><td align='center'>L</td><td align='center'>connus</td></tr>";
            for (var i = 0; i < 10 ; i++) {
                contenu += "<tr><td align='center'><b>" + i + "</b></td>";
                contenu += "<td align='center'><input type='text' id='dd" + i + "' size='4'/></td>";
                contenu += "<td align='center'><input type='text' id='sortsparjour" + i + "' size='10'/></td>";
                contenu += "<td align='center' style='color: grey' id='idp" + i + "'></td>";
                contenu += "<td align='center' style='color: grey' id='idl" + i + "'></td>";
                contenu += "<td align='center'><input type='text' id='sortsconnus" + i + "' size='10'/></td></tr>";
            }
            contenu += "<tr><td colspan='2' style='padding-top: 8px'>Concentration" + bwiki("Pathfinder-RPG.Lancer des sorts.ashx#CONCENTRATION") + "</td>";
            contenu += "<td  style='padding-top: 8px' colspan='4'><input type='text' id='conc' size='20'/></td></tr>";
            contenu += "<tr><td colspan='6'><textarea rows='5'" + tastyle + "id = 'idnotessorts'></textarea></td></tr>";
            contenu += "</table>";
            contenu += "<i style='font-size: 85%'>Domaines" + bwiki("Pathfinder-RPG.Domaines.ashx") + ", écoles" + bwiki("Pathfinder-RPG.écoles de magie.ashx") + ", lignages" + bwiki("Pathfinder-RPG.Lignages.ashx") + "</i>";
            contenu += "<textarea rows='11'" + tastyle + "id = 'iddomaines'></textarea>";
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='64%'>"
            contenu += "<center style='padding-bottom: 3px'>"
            for (var i = 0; i < 10; i++)
                contenu += "<button type='button' style='font-size: 75%' id='buts" + i + "'>" + i + "</button>&ensp;";
            contenu += "<button type='button' style='font-size: 75%' id='buts*'>*</button>&ensp;"
            contenu += "<button type='button' style='font-size: 75%' id='butsN'>Notes</button>"
            contenu += "</center>";
            contenu += "<div style='width: 100%; height: 625px; overflow: auto' id='sdiv'></div>";
            contenu += "</td>";
            contenu += "</tr></table>";
            contenu += "</td></tr></table>";
            main.innerHTML = contenu;
            bwikiset();
            for (var i = 0; i < 10; i++) {
                doc.getElementById("dd" + i).value = arrayget(p.dd, i);
                doc.getElementById("sortsparjour" + i).value = arrayget(p.sortsparjour, i);
                doc.getElementById("sortsconnus" + i).value = arrayget(p.sortsconnus, i);
            }
            doc.getElementById("conc").value = p.conc;
            doc.getElementById("idnotessorts").value = p.notessorts;
            doc.getElementById("iddomaines").value = p.domaines;
            for (var i = 0; i < 10; i++)
                doc.getElementById("buts" + i).onclick = new Function("sbut(" + i + ");");
            doc.getElementById("buts*").onclick = new Function("sbut(10);");
            doc.getElementById("butsN").onclick = new Function("sbut(11);");
            saffiche = -1;
            snums = new Array(0);
            sbut(11);
            majSorts(-1);
        }
        function ssauve() {
            if (saffiche == 11)
                p.sorts = doc.getElementById("idsorts").value;
            if (saffiche == 10) {
                for (var i = 0; i < snums.length; i++) {
                    var j = arrayget(snums, i);
                    arrayset(p.snom, j, doc.getElementById("idsnom" + j).value);
                    arrayset(p.snote, j, doc.getElementById("idsnote" + j).value);
                }
            }
            if ((saffiche < 10) && (saffiche >= 0)) {
                for (var i = 0; i < 50; i++) {
                    var j = 50 * saffiche + i;
                    arrayset(p.snom, j, doc.getElementById("idsnom" + i).value);
                    arrayset(p.snote, j, doc.getElementById("idsnote" + i).value);
                }
                arrayset(p.notessortsniv, saffiche, doc.getElementById("idnotessortsniv" + saffiche).value);
            }
        }
        function sbut(niv, choix) {
            sdiv = doc.getElementById("sdiv");
            ssauve();
            vide(sdiv);
            saffiche = niv;
            if (niv == 11) {
                sdiv.style.border = "0";
                sdiv.innerHTML = "<textarea rows='40'" + tastyle + "id='idsorts'></textarea>";
                doc.getElementById("idsorts").value = p.sorts;
            }
            if (niv == 10) {
                sdiv.style.border = "1px solid #4b3124";
                var contenu = "<table width='100%'>";
                contenu += "<tr><td colspan='8' align='right'>";
                contenu += "<select id='choixcnd' size='1' style='font-size: 85%'>";
                contenu += "<option>Afficher les sorts qui ont un nom</option>";
                contenu += "<option>Afficher les sorts préparés qui ont un nom</option>";
                contenu += "<option>Afficher les sorts lançables qui ont un nom</option>";
                contenu += "</select>&emsp;";
                contenu += "<button type='button' id='go10'>Go</button></tr>";
                var slist = "";
                for (var i = 0; i < 10; i++) {
                    contenu += "<tr><td colspan='8' style='padding: 1px; background-color: #4b3124'></td></tr>";
                    contenu += "<tr><td colspan='2' align='center' style='font-size: 85%'>Prépa</td>";
                    contenu += "<td colspan='2' align='center' style='font-size: 85%'>Lancé</td>";
                    contenu += "<td style='font-size: 85%' colspan='2'>Sort (niveau " + i + ")</td>";
                    contenu += "<td style='font-size: 85%'>Note</td><td></td></tr>";
                    contenu += "<tr><td style='font-weight: bold' align='center' id='totp" + i + "'>0</td>";
                    contenu += "<td align='center'><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/Bouton0.jpg' width='8px' id='razp" + i + "'/></td>";
                    contenu += "<td style='font-weight: bold' align='center' id='totl" + i + "'>0</td>";
                    contenu += "<td align='center'><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/Bouton0.jpg' width='8px' id='razl" + i + "'/></td>";
                    contenu += "<td colspan='4'></td></tr>";
                    for (var j = 50 * i; j < 50 * (i + 1) ; j++) {
                        var garde = (arrayget(p.snom, j) != "");
                        switch (choix) {
                            case 1:
                                garde = garde && (parseInt(arrayget(p.sprep, j)) > 0);
                                break;
                            case 2:
                                garde = garde && (parseInt(arrayget(p.sprep, j)) > parseInt(arrayget(p.slanc, j)));
                                break;
                        }
                        if (garde) {
                            slist += "," + j;
                            contenu += "<tr><td align='center' id='idsprep" + j + "'>0</td>";
                            contenu += butpm("bprep+" + j, "bprep-" + j);
                            contenu += "<td align='center' id='idslanc" + j + "'>0</td>";
                            contenu += butpm("blanc+" + j, "blanc-" + j);
                            contenu += "<td><input type='text' id='idsnom" + j + "' size='18'/></td>";
                            contenu += "<td id='idsbwiki" + j + "'></td>";
                            contenu += "<td><input type='text' id='idsnote" + j + "' size='32'/></td>";
                            contenu += "<td><button type='button' style='font-size: 75%' id='bchwiki" + j + "'>Lien</button></td></tr>";
                        }
                    }
                }
                contenu += "</table>";
                sdiv.innerHTML = contenu;
                if (choix)
                    doc.getElementById("choixcnd").selectedIndex = choix;
                doc.getElementById("go10").onclick = new Function("sbut(10,doc.getElementById('choixcnd').selectedIndex);");
                for (var i = 0; i < 10; i++) {
                    doc.getElementById("razp" + i).onclick = new Function("raz(0," + i + ",10);");
                    doc.getElementById("razl" + i).onclick = new Function("raz(1," + i + ",10);");
                }
                if (slist.length > 0)
                    snums = slist.substring(1).split(",");
                else
                    snum = new Array(0);
                for (var i = 0; i < snums.length; i++) {
                    var j = arrayget(snums, i);
                    doc.getElementById("bprep+" + j).onclick = new Function("arrayset(p.sprep," + j + ",modif(arrayget(p.sprep," + j + "),1)); majSorts(10);");
                    doc.getElementById("bprep-" + j).onclick = new Function("arrayset(p.sprep," + j + ",modif(arrayget(p.sprep," + j + "),-1)); majSorts(10);");
                    doc.getElementById("blanc+" + j).onclick = new Function("arrayset(p.slanc," + j + ",modif(arrayget(p.slanc," + j + "),1)); majSorts(10);");
                    doc.getElementById("blanc-" + j).onclick = new Function("arrayset(p.slanc," + j + ",modif(arrayget(p.slanc," + j + "),-1)); majSorts(10);");
                    doc.getElementById("bchwiki" + j).onclick = new Function("chwiki(" + j + "); majSorts(10);");
                    doc.getElementById("idsnom" + j).value = arrayget(p.snom, j);
                    doc.getElementById("idsnote" + j).value = arrayget(p.snote, j);
                    doc.getElementById("idsnom" + j).onchange = new Function("chname(" + j + ",doc.getElementById('idsnom" + j + "').value); majSorts(10);");
                }
                majSorts(10);
            }
            if ((niv >= 0) && (niv < 10)) {
                sdiv.style.border = "1px solid #4b3124";
                var contenu = "<table width='100%'>";
                contenu += "<tr><td colspan='8'><textarea rows='5'" + tastyle + "id='idnotessortsniv" + niv + "'></textarea></td></tr>";
                contenu += "<tr><td colspan='2' align='center' style='font-size: 85%'>Prépa</td>";
                contenu += "<td colspan='2' align='center' style='font-size: 85%'>Lancé</td>";
                contenu += "<td colspan='2' style='font-size: 85%'>Sort (niveau " + niv + ")</td>";
                contenu += "<td style='font-size: 85%'>Note</td>";
                contenu += "<td><button type='button' style='font-size: 75%' id='btri'>Tri</button></td></tr>";
                contenu += "<tr><td style='font-weight: bold' align='center' id='totp'>0</td>";
                contenu += "<td align='center'><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/Bouton0.jpg' width='8px' id='razp'/></td>";
                contenu += "<td style='font-weight: bold' align='center' id='totl'>0</td>";
                contenu += "<td align='center'><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/Bouton0.jpg' width='8px' id='razl'/></td>";
                contenu += "<td colspan='3'></td><td><button type='button' style='font-size: 75%' id='bvide'>Vide</button></td></tr>";
                for (var i = 0; i < 50; i++) {
                    contenu += "<tr><td align='center' id='idsprep" + i + "'>0</td>";
                    contenu += butpm("bprep+" + i, "bprep-" + i);
                    contenu += "<td align='center' id='idslanc" + i + "'>0</td>";
                    contenu += butpm("blanc+" + i, "blanc-" + i);
                    contenu += "<td><input type='text' id='idsnom" + i + "' size='18'/></td>";
                    contenu += "<td id='idsbwiki" + i + "'></td>";
                    contenu += "<td><input type='text' id='idsnote" + i + "' size='32'/></td>";
                    contenu += "<td><button type='button' style='font-size: 75%' id='bchwiki" + i + "'>Lien</button></td></tr>";
                }
                contenu += "</table>";
                sdiv.innerHTML = contenu;
                doc.getElementById("btri").onclick = new Function("stri(" + niv + ");");
                doc.getElementById("bvide").onclick = new Function("svide(" + niv + ");");
                doc.getElementById("idnotessortsniv" + niv).value = arrayget(p.notessortsniv, niv);
                doc.getElementById("razp").onclick = new Function("raz(0," + niv + "," + niv + ");");
                doc.getElementById("razl").onclick = new Function("raz(1," + niv + "," + niv + ");");
                for (var i = 0; i < 50; i++) {
                    var j = 50 * niv + i;
                    doc.getElementById("bprep+" + i).onclick = new Function("arrayset(p.sprep," + j + ",modif(arrayget(p.sprep," + j + "),1)); majSorts(" + niv + ");");
                    doc.getElementById("bprep-" + i).onclick = new Function("arrayset(p.sprep," + j + ",modif(arrayget(p.sprep," + j + "),-1)); majSorts(" + niv + ");");
                    doc.getElementById("blanc+" + i).onclick = new Function("arrayset(p.slanc," + j + ",modif(arrayget(p.slanc," + j + "),1)); majSorts(" + niv + ");");
                    doc.getElementById("blanc-" + i).onclick = new Function("arrayset(p.slanc," + j + ",modif(arrayget(p.slanc," + j + "),-1)); majSorts(" + niv + ");");
                    doc.getElementById("bchwiki" + i).onclick = new Function("chwiki(" + j + "); majSorts(" + niv + ");");
                    doc.getElementById("idsnom" + i).value = arrayget(p.snom, j);
                    doc.getElementById("idsnote" + i).value = arrayget(p.snote, j);
                    doc.getElementById("idsnom" + i).onchange = new Function("chname(" + j + ",doc.getElementById('idsnom" + i + "').value); majSorts(" + niv + ");");
                }
                majSorts(niv);
            }
            bwikiset();
        }
        function chname(j, nom) {
            if ((nom != "") && (arrayget(p.surl, j) == "")) {
                var sugg = nom.replace(/'/g, "").replace(//g, "").replace(/\u002F/g, "");
                sugg = "http://www.pathfinder-fr.org/Wiki/Pathfinder-RPG." + sugg + ".ashx";
                arrayset(p.surl, j, sugg);
            }
        }
        function chwiki(j) {
            var nom = arrayget(p.snom, j);
            var old = arrayget(p.surl, j);
            if (nom == "")
                nom = "sans nom";
            var quest = "Donnez la nouvelle adresse du lien pour le sort ";
            quest += (nom == "" ? "sans nom" : nom);
            quest += ", entrez une adresse vide pour ne mettre aucun lien ou cliquez sur Annuler pour ne rien changer.\n\n";
            if (old != "")
                quest += "Valeur actuelle : " + old + "\n\n";
            var sugg = nom.replace(/'/g, "").replace(//g, "").replace(/\u002F/g, "");
            if (sugg != "") {
                sugg = "http://www.pathfinder-fr.org/Wiki/Pathfinder-RPG." + sugg + ".ashx";
                quest += "Suggestion : " + sugg + "\n";
            }
            var rep = fen.prompt(quest, sugg);
            if (rep != null) arrayset(p.surl, j, rep);
        }
        function svide(niv) {
            if (fen.confirm("Voulez-vous vraiment effacer toutes les informations relatives aux sorts de niveau " + niv + " ?")) {
                for (var i = 50 * niv; i < 50 * (niv + 1) - 1; i++) {
                    arrayset(p.sprep, i, "0");
                    arrayset(p.slanc, i, "0");
                    arrayset(p.snom, i, "");
                    arrayset(p.snote, i, "");
                    arrayset(p.surl, i, "");
                }
            }
            saffiche = -1;
            sbut(niv);
        }
        function stri(niv) {
            ssauve();
            for (var i = 50 * niv; i < 50 * (niv + 1) - 1; i++)
                for (var j = i + 1; j < 50 * (niv + 1) ; j++) {
                    var swap = false;
                    var videi = (arrayget(p.snom, i) == "");
                    var videj = (arrayget(p.snom, j) == "");
                    swap = (!videj) && (videi || (no_accent(arrayget(p.snom, i)) > no_accent(arrayget(p.snom, j))));
                    if (swap) {
                        var tmp = arrayget(p.sprep, i);
                        arrayset(p.sprep, i, arrayget(p.sprep, j));
                        arrayset(p.sprep, j, tmp);
                        tmp = arrayget(p.slanc, i);
                        arrayset(p.slanc, i, arrayget(p.slanc, j));
                        arrayset(p.slanc, j, tmp);
                        tmp = arrayget(p.snom, i);
                        arrayset(p.snom, i, arrayget(p.snom, j));
                        arrayset(p.snom, j, tmp);
                        tmp = arrayget(p.snote, i);
                        arrayset(p.snote, i, arrayget(p.snote, j));
                        arrayset(p.snote, j, tmp);
                        tmp = arrayget(p.surl, i);
                        arrayset(p.surl, i, arrayget(p.surl, j));
                        arrayset(p.surl, j, tmp);
                    }
                }
            saffiche = -1;
            sbut(niv);
        }
        function raz(type, niv, nivmaj) {
            var quest = "Voulez-vous vraiment remettre à zéro tous les sorts ";
            if (type == 0)
                quest += "préparés ?";
            else
                quest += "lancés ?";
            if (fen.confirm(quest))
                if (type == 0)
                    for (var i = 50 * niv; i < 50 * (niv + 1) ; i++)
                        arrayset(p.sprep, i, 0);
                else
                    for (var i = 50 * niv; i < 50 * (niv + 1) ; i++)
                        arrayset(p.slanc, i, 0);
            majSorts(niv, nivmaj);
        }
        function majSorts(niv) {
            if ((niv >= 0) && (niv < 10)) {
                var totp = 0;
                var totl = 0;
                for (var i = 0; i < 50; i++) {
                    var j = 50 * niv + i;
                    doc.getElementById("idsprep" + i).innerHTML = arrayget(p.sprep, j);
                    doc.getElementById("idslanc" + i).innerHTML = arrayget(p.slanc, j);
                    totp += parseInt(arrayget(p.sprep, j));
                    totl += parseInt(arrayget(p.slanc, j));
                    if (arrayget(p.surl, j) != "")
                        doc.getElementById("idsbwiki" + i).innerHTML = bwiki("!" + arrayget(p.surl, j));
                    else
                        doc.getElementById("idsbwiki" + i).innerHTML = "";
                }
                doc.getElementById("totp").innerHTML = totp;
                doc.getElementById("totl").innerHTML = totl;
                doc.getElementById("idp" + niv).innerHTML = totp;
                doc.getElementById("idl" + niv).innerHTML = totl;
            }
            if (niv == 10) {
                for (var i = 0; i < snums.length; i++) {
                    var j = arrayget(snums, i);
                    doc.getElementById("idsprep" + j).innerHTML = arrayget(p.sprep, j);
                    doc.getElementById("idslanc" + j).innerHTML = arrayget(p.slanc, j);
                    if (arrayget(p.surl, j) != "")
                        doc.getElementById("idsbwiki" + j).innerHTML = bwiki("!" + arrayget(p.surl, j));
                    else
                        doc.getElementById("idsbwiki" + j).innerHTML = "";
                }
            }
            if ((niv == -1) || (niv == 10)) {
                for (var i = 0; i < 10; i++) {
                    var totp = 0;
                    var totl = 0;
                    for (var j = 50 * i; j < 50 * (i + 1) ; j++) {
                        totp += parseInt(arrayget(p.sprep, j));
                        totl += parseInt(arrayget(p.slanc, j));
                    }
                    doc.getElementById("idp" + i).innerHTML = totp;
                    doc.getElementById("idl" + i).innerHTML = totl;
                    if (niv == 10) {
                        doc.getElementById("totp" + i).innerHTML = totp;
                        doc.getElementById("totl" + i).innerHTML = totl;
                    }
                }
            }
            bwikiset();
        }
        function bEquip() {
            sauve();
            vide(main);
            affiche = 6;
            main.style.border = "1px solid #3b3124";
            var contenu = "<table width='100%'><tr><td>";
            contenu += "<table width='100%'>";
            contenu += "<tr style='vertical-align: top'>";
            contenu += "<td width='49%'>";
            contenu += "<i style='font-size: 85%'>Équipement</i>" + bwiki("Pathfinder-RPG.Tableau récapitulatif des armures.ashx");
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            for (var i = 0; i < pl ; i++) {
                var nom = arrayget(ptab, i);
                var titre = (nom.substring(0, 1) == "*");
                if (titre) {
                    contenu += "<tr><td colspan='2' align='center' style='font-size: 80%'><b>~ " + nom.substring(1) + " ~</b></td>";
                    if (i == 0)
                        contenu += "<td align='center'>Poids</td>";
                    contenu += "</tr>";
                }
                else {
                    contenu += "<tr><td>" + nom + "</td>";
                    contenu += "<td><input type='text' id='idparure" + i + "' size='40'/></td>";
                    contenu += "<td><input type='text' id='idpoidsparure" + i + "' size='4'/></td></tr>";
                    if (nom == "Armure") {
                        contenu += "<tr><td></td><td colspan='2'><table width='100%'><tr>";
                        contenu += "<td>MaxDex <input type='text' id='idmaxdexarmure' size='3'/></td>";
                        contenu += "<td>Pénal <input type='text' id='idpénalitéarmure' size='3'/></td>";
                        contenu += "<td>Éch sorts <input type='text' id='idéchecsortsarmure' size='3'/></td>";
                        contenu += "</tr></table></td></tr>";
                    }
                    if (nom == "Bouclier") {
                        contenu += "<tr><td></td><td colspan='2'><table width='100%'><tr>";
                        contenu += "<td>MaxDex <input type='text' id='idmaxdexbouclier' size='3'/></td>";
                        contenu += "<td>Pénal <input type='text' id='idpénalitébouclier' size='3'/></td>";
                        contenu += "<td>Éch sorts <input type='text' id='idéchecsortsbouclier' size='3'/></td>";
                        contenu += "</tr></table></td></tr>";
                    }
                }
            }
            contenu += "</table>";
            contenu += "<i style='font-size: 85%'>Richesses</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td width='85%'><textarea rows='3'" + tastyle + "id = 'idrichesses'></textarea></td>";
            contenu += "<td width='15%'><center>Poids<br/><input type='text' id='idpoidsrichesses' size='3'/><br/>";
            contenu += "<span style='font-size: 85%'><i>1 pièce<br/>= 0.01kg</i></span></center></td></tr>";
            contenu += "</table>"
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='50%'>";
            contenu += "<i style='font-size: 85%'>Possessions</i>" + bwiki("Pathfinder-RPG.Matériel daventurier.ashx");
            contenu += "<span style='font-size: 85%'>";
            for (var i = 0; i < 6; i++)
                contenu += "&ensp;<button type='button' style='font-size: 80%' id='ebut" + i + "'>" + (i + 1) + "</button>";
            contenu += "&ensp;<button type='button' style='font-size: 80%' id='etri'>Tri</button>";
            contenu += "&ensp;<button type='button' style='font-size: 80%' id='evide'>Vide</button>";
            contenu += "</span>";
            contenu += "<div style='width: 100%; height: 410px; border: 1px solid #4b3124; overflow: auto' id='ediv'>";
            contenu += "</div>";
            contenu += "<i style='font-size: 85%'>Total</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>Poids total" + bwiki("Pathfinder-RPG.État civil et mensurations.ashx#POIDSTRANSPORTABLE") + "</td><td id='poidstotal'>0 kg</td></tr>";
            contenu += "<tr><td colspan='2' id='charge' style='color: gray; font-size: 80%'>???</td></tr>";
            contenu += "<tr><td colspan='2' id='chval' style='color: gray; font-size: 80%'></td></tr>";
            contenu += "</table>";
            contenu += "<i style='font-size: 85%'>Notes</i>";
            contenu += "<textarea rows='7'" + tastyle + "id = 'idnoteséquipement'></textarea>";
            contenu += "</td>";
            contenu += "</tr></table>";
            contenu += "</td></tr></table>";
            main.innerHTML = contenu;
            bwikiset();
            for (var i = 0; i < 6; i++)
                doc.getElementById("ebut" + i).onclick = new Function("ebut(" + i + "); majEquip();");
            doc.getElementById("etri").onclick = new Function("etri();");
            doc.getElementById("evide").onclick = new Function("evide();");
            for (var i = 0; i < pl ; i++) {
                var titre = (arrayget(ptab, i).substring(0, 1) == "*");
                if (!titre) {
                    doc.getElementById("idparure" + i).value = arrayget(p.parure, i);
                    doc.getElementById("idpoidsparure" + i).value = arrayget(p.poidsparure, i);
                    doc.getElementById("idpoidsparure" + i).onchange = new Function("sauve(); majEquip();");
                }
            }
            doc.getElementById("idmaxdexarmure").value = p.maxdexarmure;
            doc.getElementById("idpénalitéarmure").value = p.pénalitéarmure;
            doc.getElementById("idéchecsortsarmure").value = p.échecsortsarmure;
            doc.getElementById("idmaxdexbouclier").value = p.maxdexbouclier;
            doc.getElementById("idpénalitébouclier").value = p.pénalitébouclier;
            doc.getElementById("idéchecsortsbouclier").value = p.échecsortsbouclier;
            doc.getElementById("idrichesses").value = p.richesses;
            doc.getElementById("idpoidsrichesses").value = p.poidsrichesses;
            doc.getElementById("idpoidsrichesses").onchange = new Function("sauve(); majEquip();");
            doc.getElementById("idnoteséquipement").value = p.noteséquipement;
            eaffiche = -1;
            ebut(0);
            majEquip();
        }
        function esauve() {
            if (eaffiche != -1) {
                arrayset(p.sacoches, eaffiche, doc.getElementById("sacnom").value);
                arrayset(p.sacochescompte, eaffiche, (doc.getElementById('sacpoids').checked ? "1" : "0"));
                for (var i = 0; i < 25 ; i++) {
                    var j = 25 * eaffiche + i;
                    arrayset(p.objets, j, doc.getElementById("idobjets" + j).value);
                    arrayset(p.poidsobjets, j, doc.getElementById("idpoids" + j).value);
                }
            }
        }
        function ebut(sac) {
            var ediv = doc.getElementById("ediv");
            esauve();
            eaffiche = sac;
            var contenu = "<center>Sac #" + (sac + 1) + "&ensp;<input id='sacnom' type='text' size='30'/>";
            contenu += "&emsp;Pds <input id='sacpoids' type='checkbox'/>&ensp;<span id='sacpds'>0 kg</span></center>";
            contenu += "<table style='font-size: 80%'>";
            contenu += "<tr><td>Objet</td><td>Poids</td></tr>";
            for (var i = 0; i < 25 ; i++) {
                var j = 25 * sac + i;
                contenu += "<tr><td><input type='text' id='idobjets" + j + "' size='50'/></td>";
                contenu += "<td><input type='text' id='idpoids" + j + "' size='4'/></td></tr>";
            }
            contenu += "</table>";
            ediv.innerHTML = contenu;
            doc.getElementById("sacnom").value = arrayget(p.sacoches, sac);
            doc.getElementById("sacpoids").checked = (arrayget(p.sacochescompte, sac) == "1");
            doc.getElementById("sacpoids").onchange = new Function("esauve(); majEquip();");
            for (var i = 0; i < 25 ; i++) {
                var j = 25 * sac + i;
                doc.getElementById("idobjets" + j).value = arrayget(p.objets, j);
                doc.getElementById("idpoids" + j).value = arrayget(p.poidsobjets, j);
                doc.getElementById("idpoids" + j).onchange = new Function("esauve(); majEquip();");
            }
        }
        function etri() {
            var sac = eaffiche;
            esauve();
            for (var i = 25 * sac; i < 25 * (sac + 1) - 1; i++)
                for (var j = i + 1; j < 25 * (sac + 1) ; j++) {
                    var swap = false;
                    var videi = (arrayget(p.objets, i) == "");
                    var videj = (arrayget(p.objets, j) == "");
                    swap = (!videj) && (videi || (no_accent(arrayget(p.objets, i)) > no_accent(arrayget(p.objets, j))));
                    if (swap) {
                        var tmp = arrayget(p.objets, i);
                        arrayset(p.objets, i, arrayget(p.objets, j));
                        arrayset(p.objets, j, tmp);
                        tmp = arrayget(p.poidsobjets, i);
                        arrayset(p.poidsobjets, i, arrayget(p.poidsobjets, j));
                        arrayset(p.poidsobjets, j, tmp);
                    }
                }
            eaffiche = -1;
            ebut(sac);
        }
        function evide() {
            var sac = eaffiche;
            if (fen.confirm("Voulez-vous vraiment effacer tous les objets de la sacoche #" + (sac + 1) + " ?")) {
                for (var i = 25 * sac; i < 25 * (sac + 1) ; i++) {
                    arrayset(p.objets, i, "");
                    arrayset(p.poidsobjets, i, "0");
                }
            }
            eaffiche = -1;
            ebut(sac);
        }
        function majEquip() {
            var tot = 0;
            var totsac = 0;
            for (var i = 0; i < 25; i++) {
                var j = eaffiche * 25 + i;
                totsac += parseFloat(arrayget(p.poidsobjets, j));
            }
            doc.getElementById("sacpds").innerHTML = "" + totsac + " kg";
            for (var i = 0; i < pl; i++)
                tot += parseFloat(arrayget(p.poidsparure, i));
            for (var sac = 0; sac < 6; sac++)
                if (arrayget(p.sacochescompte, sac) == "1")
                    for (var i = 0; i < 25; i++) {
                        var j = sac * 25 + i;
                        tot += parseFloat(arrayget(p.poidsobjets, j));
                    }
            tot += parseFloat(p.poidsrichesses);
            tot = Math.round(tot * 100) / 100;
            doc.getElementById("poidstotal").innerHTML = "" + tot + " kg";
            var forc = parseInt(p.force);
            var mult = 1;
            while (forc > 29) {
                forc = forc - 10;
                mult = mult * 4;
            }
            var chm = parseFloat(arrayget(chmoytab, forc - 1)) * mult * arrayget(chmodtailletab, parseInt(p.ctaille));
            var chl = parseFloat(arrayget(chloutab, forc - 1)) * mult * arrayget(chmodtailletab, parseInt(p.ctaille));
            var chx = parseFloat(arrayget(chmaxtab, forc - 1)) * mult * arrayget(chmodtailletab, parseInt(p.ctaille));
            doc.getElementById("chval").innerHTML = "Charge moyenne " + chm + "kg, lourde " + chl + " kg, max " + chx + " kg";
            if (tot < chm)
                doc.getElementById("charge").innerHTML = "= charge légère (pas de pénalité)";
            else if (tot < chl)
                doc.getElementById("charge").innerHTML = "= charge moyenne (Max Dex +3, pénalité -3, course ×4, VD réduite)";
            else if (tot < chx)
                doc.getElementById("charge").innerHTML = "= charge lourde (Max Dex +1, pénalité -6, course ×3, VD réduite)";
            else
                doc.getElementById("charge").innerHTML = "= charge extrême (ne peut se déplacer)";
        }
        function bCompa() {
            sauve();
            vide(main);
            affiche = 9;
            main.style.border = "1px solid #3b3124";
            var contenu = "<table width='100%'><tr><td>";
            contenu += "<table width='100%'>";
            contenu += "<tr>";
            contenu += "<td width='24%'>";
            contenu += "<i style='font-size: 85%'>Identité</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>Nom</td>";
            contenu += "<td><input type='text' id='compnom' size='15'/></td></tr>";
            contenu += "<tr><td>Relation</td>";
            contenu += "<td><input type='text' id='comprelation' size='15'/></td></tr>";
            contenu += "<tr><td>Race</td>";
            contenu += "<td><input type='text' id='comprace' size='15'/></td></tr>";
            contenu += "<tr><td>Type</td>";
            contenu += "<td><input type='text' id='comptype' size='15'/></td></tr>";
            contenu += "<tr><td>Taille</td>";
            contenu += "<td><input type='text' id='comptaille' size='15'/></td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='24%'>";
            contenu += "<i style='font-size: 85%'>Exploration</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>Init</td>";
            contenu += "<td><input type='text' id='compinit' size='16'/></td></tr>";
            contenu += "<tr><td>VD</td>";
            contenu += "<td><input type='text' id='compvd' size='16'/></td></tr>";
            contenu += "<tr><td>Vision</td>";
            contenu += "<td><input type='text' id='compvision' size='16'/></td></tr>";
            contenu += "<tr><td colspan='2'>";
            contenu += "<textarea rows='2'" + tastyle + "id = 'idcomp1'></textarea>";
            contenu += "</td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='24%'>";
            contenu += "<i style='font-size: 85%'>Jets de sauvegarde</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>Réf</td>";
            contenu += "<td><input type='text' id='compref' size='18'/></td></tr>";
            contenu += "<tr><td>Vig</td>";
            contenu += "<td><input type='text' id='compvig' size='18'/></td></tr>";
            contenu += "<tr><td>Vol</td>";
            contenu += "<td><input type='text' id='compvol' size='18'/></td></tr>";
            contenu += "<tr><td colspan='2'>";
            contenu += "<textarea rows='2'" + tastyle + "id = 'idcomp2'></textarea>";
            contenu += "</td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td width='1%'></td>";
            contenu += "<td width='24%'>";
            contenu += "<i style='font-size: 85%'>Points de vie</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>pv</td>";
            contenu += "<td><input type='text' id='comppv' size='15'/></td></tr>";
            contenu += "<tr><td>pvmax</td>";
            contenu += "<td><input type='text' id='comppvmax' size='15'/></td></tr>";
            contenu += "<tr><td>Non-létal</td>";
            contenu += "<td><input type='text' id='compdgnl' size='15'/></td></tr>";
            contenu += "<tr><td colspan='2'>";
            contenu += "<textarea rows='2'" + tastyle + "id = 'idcomp3'></textarea>";
            contenu += "</td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "</tr>";
            contenu += "<tr>"
            contenu += "<td>";
            contenu += "<i style='font-size: 85%'>Caractéristiques</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>For</td>";
            contenu += "<td><input type='text' id='compfor' size='18'/></td></tr>";
            contenu += "<tr><td>Dex</td>";
            contenu += "<td><input type='text' id='compdex' size='18'/></td></tr>";
            contenu += "<tr><td>Con</td>";
            contenu += "<td><input type='text' id='compcon' size='18'/></td></tr>";
            contenu += "<tr><td>Int</td>";
            contenu += "<td><input type='text' id='compint' size='18'/></td></tr>";
            contenu += "<tr><td>Sag</td>";
            contenu += "<td><input type='text' id='compsag' size='18'/></td></tr>";
            contenu += "<tr><td>Cha</td>";
            contenu += "<td><input type='text' id='compcha' size='18'/></td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td></td>";
            contenu += "<td>";
            contenu += "<i style='font-size: 85%'>Valeurs de combat</i>";
            contenu += "<table width='100%' style='border: 1px solid #4b3124'>";
            contenu += "<tr><td>BBA</td>";
            contenu += "<td><input type='text' id='compbba' size='14'/></td></tr>";
            contenu += "<tr><td>BMO</td>";
            contenu += "<td><input type='text' id='compbmo' size='14'/></td></tr>";
            contenu += "<tr><td>DMD</td>";
            contenu += "<td><input type='text' id='compdmd' size='14'/></td></tr>";
            contenu += "<tr><td>CA</td>";
            contenu += "<td><input type='text' id='compca' size='14'/></td></tr>";
            contenu += "<tr><td>CA contact</td>";
            contenu += "<td><input type='text' id='compcacontact' size='14'/></td></tr>";
            contenu += "<tr><td>CA surpris</td>";
            contenu += "<td><input type='text' id='compcasurpris' size='14'/></td></tr>";
            contenu += "</table>";
            contenu += "</td>";
            contenu += "<td></td>";
            contenu += "<td colspan='3'>";
            contenu += "<i style='font-size: 85%'>Attaques</i>";
            contenu += "<textarea rows='9'" + tastyle + "id = 'idcomp4'></textarea>";
            contenu += "</td>";
            contenu += "</tr>";
            contenu += "<tr>";
            contenu += "<td>";
            contenu += "<i style='font-size: 85%'>Compétences</i>";
            contenu += "<textarea rows='8'" + tastyle + "id = 'idcomp5'></textarea>";
            contenu += "</td>";
            contenu += "<td></td>";
            contenu += "<td>";
            contenu += "<i style='font-size: 85%'>Dons</i>";
            contenu += "<textarea rows='8'" + tastyle + "id = 'idcomp6'></textarea>";
            contenu += "</td>";
            contenu += "<td></td>";
            contenu += "<td colspan='3'>";
            contenu += "<i style='font-size: 85%'>Capacités spéciales</i>";
            contenu += "<textarea rows='8'" + tastyle + "id = 'idcomp7'></textarea>";
            contenu += "</td>";
            contenu += "</tr>";
            contenu += "<tr>";
            contenu += "<td colspan='7'>";
            contenu += "<i style='font-size: 85%'>Notes</i>";
            contenu += "<textarea rows='8'" + tastyle + "id = 'idcomp8'></textarea>";
            contenu += "</td>";
            contenu += "</tr>";
            contenu += "</table>";
            contenu += "</td></tr></table>";
            main.innerHTML = contenu;
            doc.getElementById("compnom").value = p.compnom;
            doc.getElementById("comprelation").value = p.comprelation;
            doc.getElementById("comprace").value = p.comprace;
            doc.getElementById("comptype").value = p.comptype;
            doc.getElementById("comptaille").value = p.comptaille;
            doc.getElementById("compinit").value = p.compinit;
            doc.getElementById("compvd").value = p.compvd;
            doc.getElementById("compvision").value = p.compvision;
            doc.getElementById("idcomp1").value = p.idcomp1;
            doc.getElementById("compref").value = p.compref;
            doc.getElementById("compvig").value = p.compvig;
            doc.getElementById("compvol").value = p.compvol;
            doc.getElementById("idcomp2").value = p.idcomp2;
            doc.getElementById("comppv").value = p.comppv;
            doc.getElementById("comppvmax").value = p.comppvmax;
            doc.getElementById("compdgnl").value = p.compdgnl;
            doc.getElementById("idcomp3").value = p.idcomp3;
            doc.getElementById("compfor").value = p.compfor;
            doc.getElementById("compdex").value = p.compdex;
            doc.getElementById("compcon").value = p.compcon;
            doc.getElementById("compint").value = p.compint;
            doc.getElementById("compsag").value = p.compsag;
            doc.getElementById("compcha").value = p.compcha;
            doc.getElementById("compbba").value = p.compbba;
            doc.getElementById("compbmo").value = p.compbmo;
            doc.getElementById("compdmd").value = p.compdmd;
            doc.getElementById("compca").value = p.compca;
            doc.getElementById("compcacontact").value = p.compcacontact;
            doc.getElementById("compcasurpris").value = p.compcasurpris;
            doc.getElementById("idcomp4").value = p.idcomp4;
            doc.getElementById("idcomp5").value = p.idcomp5;
            doc.getElementById("idcomp6").value = p.idcomp6;
            doc.getElementById("idcomp7").value = p.idcomp7;
            doc.getElementById("idcomp8").value = p.idcomp8;
        }
        function bNotes() {
            sauve();
            vide(main);
            affiche = 7;
            main.style.border = "0";
            var ta = doc.createElement("textarea");
            ta.style.width = "100%";
            ta.style.backgroundColor = "#f3efe2";
            ta.id = "idnotes";
            ta.rows = "40";
            ta.style.fontfamily = "monospace";
            main.appendChild(ta);
            ta.value = p.notes;
        }
        function bCode() {
            sauve();
            vide(main);
            affiche = 8;
            main.style.border = "0";
            var contenu = "<table width='100%'><tr><td width='24%'>";
            contenu += "<i style='font-size: 85%'>Blocs de texte <button type='button' style='font-size: 80%; float:right' id='razbt'>valeurs par défaut</button></i>";
            contenu += "<table style='border: 1px solid #4b3124; clear: right' width='100%'>";
            contenu += "<tr><td>Couleur</td><td colspan='2'><input type='text' id='idtabc' size='12'/></td></tr>";
            contenu += "<tr><td>Taille police</td>";
            contenu += butpm("tafs+", "tafs-");
            contenu += "<td id='idtafs'></td>";
            contenu += "</tr></table>";
            contenu += "</td><td width='1%'></td>";
            contenu += "<td width='24%'>";
            contenu += "<i style='font-size: 85%'>Réinitialisation</i>";
            contenu += "<table style='border: 1px solid #4b3124' width='100%'>";
            contenu += "<tr><td><button id='razequip' type='button'>équipement</button></td>";
            contenu += "<td><button id='razsorts' type='button'>sorts</button></td></tr>";
            contenu += "<tr><td><button id='razcomp' type='button'>compagnon</button></td>";
            contenu += "<td><button id='raztout' type='button'>tout</button></td></tr>";
            contenu += "</table>";
            contenu += "</td><td width='1%'></td>";
            contenu += "<td width='49%'>";
            contenu += "<i style='font-size: 85%'>Affichage</i>";
            contenu += "<table style='border: 1px solid #4b3124' width='100%'>";
            contenu += "<tr><td><input type='checkbox' id='bshowmagie'> Afficher Magie</td>";
            contenu += "<td><input type='checkbox' id='bshowmagempty'> Afficher niveaux vides</td></tr>";
            contenu += "<tr><td><input type='checkbox' id='bshowcomp'> Afficher Compagnon</td></tr>";
            contenu += "</table>";
            contenu += "</tr></table>";
            contenu += "<table width='100%'><tr><td colspan='7'>";
            contenu += "<i style='font-size: 85%'>Code à copier dans la page wiki</i>";
            contenu += "<textarea rows='36'" + tastyle + "id = 'idcode'></textarea>";
            contenu += "</td></tr></table>";
            main.innerHTML = contenu;
            majCode();
            doc.getElementById("tafs+").onclick = new Function("tafs = modif(tafs,1); majCode();");
            doc.getElementById("tafs-").onclick = new Function("tafs = modif(tafs,-1); majCode();");
            doc.getElementById("idtabc").onchange = new Function("tabc = doc.getElementById('idtabc').value; majCode();");
            doc.getElementById("razbt").onclick = new Function("tafs = '90'; tabc = '#f3efe2'; majCode();");
            doc.getElementById("razequip").onclick = new Function("razequip(); majCode();");
            doc.getElementById("razsorts").onclick = new Function("razsorts(); majCode();");
            doc.getElementById("razcomp").onclick = new Function("razcomp(); majCode();");
            doc.getElementById("raztout").onclick = new Function("raztout(); majCode();");
            doc.getElementById("bshowmagie").onclick = new Function("p.showmagie = (p.showmagie == '0' ? '1' : '0'); majCode();");
            doc.getElementById("bshowmagempty").onclick = new Function("p.showmagempty = (p.showmagempty == '0' ? '1' : '0'); majCode();");
            doc.getElementById("bshowcomp").onclick = new Function("p.showcomp = (p.showcomp == '0' ? '1' : '0'); majCode();");
        }
        function majCode() {
            doc.getElementById("idtabc").value = tabc;
            doc.getElementById("idtafs").innerHTML = tafs;
            var code = JSON.stringify(p).replace(/\u005b/g, "00LBR00").replace(/\u005d/g, "00RBR00").replace(/'/g, "00GUI00").replace(/{/g, "00LCB00").replace(/\\/g, "\\\\");
            var sortie = "{" + "s:FDPavant}<" + "nowiki>\n";
            sortie += "tabc = '" + tabc + "';";
            sortie += "tafs = '" + tafs + "';";
            sortie += "pdesc += '" + code + "';\n";
            sortie += "<" + "/nowiki>{" + "s:FDPapres}\n";
            doc.getElementById("idcode").value = sortie;
            doc.getElementById("idcode").style.backgroundColor = tabc;
            doc.getElementById("idcode").style.fontSize = tafs + "%";
            tastyle = " style='font-family: monospace; width: 100%; background-color: " + tabc + "; font-size: " + tafs + "%' ";
            if (p.showmagie == "1") {
                doc.getElementById("bshowmagie").checked = "checked";
                doc.getElementById("bshowmagempty").checked = (p.showmagempty == "1" ? "checked" : "");
                doc.getElementById("bshowmagempty").disabled = "";
            } else {
                doc.getElementById("bshowmagie").checked = "";
                doc.getElementById("bshowmagempty").checked = (p.showmagempty == "1" ? "checked" : "");
                doc.getElementById("bshowmagempty").disabled = "disabled";
            }
            doc.getElementById("bshowcomp").checked = (p.showcomp == "1" ? "checked" : "");
        }
        function razequip() {
            if (fen.confirm("Voulez-vous vraiment effacer toutes les informations concernant l'équipement ?")) {
                p.parure = new Array(20);
                p.poidsparure = new Array(20);
                p.objets = new Array(150);
                p.poidsobjets = new Array(150);
                p.sacoches = new Array(6);
                p.sacochescompte = new Array(6);
                p.maxdexarmure = "";
                p.pénalitéarmure = "";
                p.échecsortsarmure = "";
                p.maxdexbouclier = "";
                p.pénalitébouclier = "";
                p.échecsortsbouclier = "";
                p.richesses = "";
                p.poidsrichesses = "0";
                p.noteséquipement = "";
                for (var i = 0; i < 6; i++) {
                    arrayset(p.sacoches, i, "");
                    arrayset(p.sacochescompte, i, "1");
                }
                for (var i = 0; i < 20; i++) {
                    arrayset(p.parure, i, "");
                    arrayset(p.poidsparure, i, "0");
                }
                for (var i = 0; i < 150; i++) {
                    arrayset(p.objets, i, "");
                    arrayset(p.poidsobjets, i, "0");
                }
            }
        }
        function razsorts() {
            if (fen.confirm("Voulez-vous vraiment effacer toutes les informations concernant les sorts ?")) {
                p.sortsparjour = new Array(10);
                p.sortsconnus = new Array(10);
                p.dd = new Array(10);
                for (var i = 0; i < 10; i++) {
                    arrayset(p.sortsparjour, i, "");
                    arrayset(p.sortsconnus, i, "");
                    arrayset(p.dd, i, "");
                }
                p.domaines = "";
                p.sorts = "";
                p.notessorts = "";
                p.conc = "";
                p.notessortsniv = new Array(10);
                for (var i = 0; i < 10; i++)
                    arrayset(p.notessortsniv, i, "");
                p.snom = new Array(500);
                p.snote = new Array(500);
                p.sprep = new Array(500);
                p.slanc = new Array(500);
                p.surl = new Array(500);
                for (var i = 0; i < 500; i++) {
                    arrayset(p.snom, i, "");
                    arrayset(p.snote, i, "");
                    arrayset(p.sprep, i, "0");
                    arrayset(p.slanc, i, "0");
                    arrayset(p.surl, i, "");
                }
            }
        }
        function razcomp() {
            if (fen.confirm("Voulez-vous vraiment effacer toutes les informations concernant le compagnon ?")) {
                p.compnom = "";
                p.comprelation = "";
                p.comprace = "";
                p.comptype = "";
                p.comptaille = "";
                p.compinit = "";
                p.compvd = "";
                p.compvision = "";
                p.idcomp1 = "";
                p.compref = "";
                p.compvig = "";
                p.compvol = "";
                p.idcomp2 = "";
                p.comppv = "";
                p.comppvmax = "";
                p.compdgnl = "";
                p.idcomp3 = "";
                p.compfor = "";
                p.compdex = "";
                p.compcon = "";
                p.compint = "";
                p.compsag = "";
                p.compcha = "";
                p.compbba = "";
                p.compbmo = "";
                p.compdmd = "";
                p.compca = "";
                p.compcacontact = "";
                p.compcasurpris = "";
                p.idcomp4 = "";
                p.idcomp5 = "";
                p.idcomp6 = "";
                p.idcomp7 = "";
                p.idcomp8 = "";
            }
        }
        function raztout() {
            if (fen.confirm("Voulez-vous vraiment effacer toutes les informations de cette feuille de personnage ?")) {
                p = new perso();
            }
        }
        function sauve() {
            if (affiche == 1) {
                p.nom = doc.getElementById("idnom").value;
                p.race = doc.getElementById("idrace").value;
                p.sexe = doc.getElementById("idsexe").value;
                p.ctaille = "" + doc.getElementById("idctaille").selectedIndex;
                p.joueur = doc.getElementById("idjoueur").value;
                p.md = doc.getElementById("idmd").value;
                p.partie = doc.getElementById("idpartie").value;
                p.classes = doc.getElementById("idclasses").value;
                p.cdp = doc.getElementById("idcdp").value;
                p.religion = doc.getElementById("idreligion").value;
                p.origine = doc.getElementById("idorigine").value;
                p.align = doc.getElementById("idalign").value;
                p.age = doc.getElementById("idage").value;
                p.dextrie = doc.getElementById("iddextrie").value;
                p.poids = doc.getElementById("idpoids").value;
                p.taille = doc.getElementById("idtaille").value;
                p.yeux = doc.getElementById("idyeux").value;
                p.cheveux = doc.getElementById("idcheveux").value;
                p.peau = doc.getElementById("idpeau").value;
                p.noteidentité = doc.getElementById("idnoteidentité").value;
            }
            if (affiche == 2) {
                p.initnote = doc.getElementById("idinitnote").value;
                p.vd = doc.getElementById("idvd").value;
                p.vision = doc.getElementById("idvision").value;
                p.notesexplo = doc.getElementById("idnotesexplo").value;
                p.refnote = doc.getElementById("idrefnote").value;
                p.vignote = doc.getElementById("idvignote").value;
                p.volnote = doc.getElementById("idvolnote").value;
                p.notesjds = doc.getElementById("idnotesjds").value;
                p.pv = doc.getElementById("idpv").value;
                p.pvmax = doc.getElementById("idpvmax").value;
                p.dgnl = doc.getElementById("iddgnl").value;
                p.notespv = doc.getElementById("idnotespv").value;
                p.bmo = doc.getElementById("idbmo").value;
                p.dmd = doc.getElementById("iddmd").value;
                p.ca = doc.getElementById("idca").value;
                p.casurpris = doc.getElementById("idcasurpris").value;
                p.cacontact = doc.getElementById("idcacontact").value;
                p.notescombat = doc.getElementById("idnotescombat").value;
                p.notescombat2 = doc.getElementById("idnotescombat2").value;
                p.armes = doc.getElementById("idarmes").value;
            }
            if (affiche == 3) {
                p.traits = doc.getElementById("idtraits").value;
                p.cpmartiales = doc.getElementById("idcpmartiales").value;
                p.capacités = doc.getElementById("idcapacités").value;
                p.dons = doc.getElementById("iddons").value;
                p.langues = doc.getElementById("idlangues").value;
                p.notescapacités = doc.getElementById("idnotescapacités").value;
            }
            if (affiche == 4) {
                for (var i = 0; i < cl; i++) {
                    var nom = arrayget(ctab, i);
                    if (nom.substring(0, 1) == "I") nom = nom.substring(1);
                    var ajout = (nom.substring(1, 2) == "*");
                    if (ajout)
                        arrayset(p.cnom, i, doc.getElementById("idcnom" + i).value);
                    arrayset(p.cnote, i, doc.getElementById("idcnote" + i).value);
                }
                p.notescompétences = doc.getElementById("idnotescompétences").value;
            }
            if (affiche == 5) {
                for (var i = 0; i < 10; i++) {
                    arrayset(p.dd, i, doc.getElementById("dd" + i).value);
                    arrayset(p.sortsparjour, i, doc.getElementById("sortsparjour" + i).value);
                    arrayset(p.sortsconnus, i, doc.getElementById("sortsconnus" + i).value);
                }
                p.conc = doc.getElementById("conc").value;
                p.notessorts = doc.getElementById("idnotessorts").value;
                p.domaines = doc.getElementById("iddomaines").value;
                ssauve();
            }
            if (affiche == 6) {
                for (var i = 0; i < pl ; i++) {
                    var titre = (arrayget(ptab, i).substring(0, 1) == "*");
                    if (!titre) {
                        arrayset(p.parure, i, doc.getElementById("idparure" + i).value);
                        arrayset(p.poidsparure, i, doc.getElementById("idpoidsparure" + i).value);
                    }
                }
                esauve();
                p.maxdexarmure = doc.getElementById("idmaxdexarmure").value;
                p.pénalitéarmure = doc.getElementById("idpénalitéarmure").value;
                p.échecsortsarmure = doc.getElementById("idéchecsortsarmure").value;
                p.maxdexbouclier = doc.getElementById("idmaxdexbouclier").value;
                p.pénalitébouclier = doc.getElementById("idpénalitébouclier").value;
                p.échecsortsbouclier = doc.getElementById("idéchecsortsbouclier").value;
                p.richesses = doc.getElementById("idrichesses").value;
                p.poidsrichesses = doc.getElementById("idpoidsrichesses").value;
                p.noteséquipement = doc.getElementById("idnoteséquipement").value;
            }
            if (affiche == 7)
                p.notes = doc.getElementById("idnotes").value;
            if (affiche == 9) {
                p.compnom = doc.getElementById("compnom").value;
                p.comprelation = doc.getElementById("comprelation").value;
                p.comprace = doc.getElementById("comprace").value;
                p.comptype = doc.getElementById("comptype").value;
                p.comptaille = doc.getElementById("comptaille").value;
                p.compinit = doc.getElementById("compinit").value;
                p.compvd = doc.getElementById("compvd").value;
                p.compvision = doc.getElementById("compvision").value;
                p.idcomp1 = doc.getElementById("idcomp1").value;
                p.compref = doc.getElementById("compref").value;
                p.compvig = doc.getElementById("compvig").value;
                p.compvol = doc.getElementById("compvol").value;
                p.idcomp2 = doc.getElementById("idcomp2").value;
                p.comppv = doc.getElementById("comppv").value;
                p.comppvmax = doc.getElementById("comppvmax").value;
                p.compdgnl = doc.getElementById("compdgnl").value;
                p.idcomp3 = doc.getElementById("idcomp3").value;
                p.compfor = doc.getElementById("compfor").value;
                p.compdex = doc.getElementById("compdex").value;
                p.compcon = doc.getElementById("compcon").value;
                p.compint = doc.getElementById("compint").value;
                p.compsag = doc.getElementById("compsag").value;
                p.compcha = doc.getElementById("compcha").value;
                p.compbba = doc.getElementById("compbba").value;
                p.compbmo = doc.getElementById("compbmo").value;
                p.compdmd = doc.getElementById("compdmd").value;
                p.compca = doc.getElementById("compca").value;
                p.compcacontact = doc.getElementById("compcacontact").value;
                p.compcasurpris = doc.getElementById("compcasurpris").value;
                p.idcomp4 = doc.getElementById("idcomp4").value;
                p.idcomp5 = doc.getElementById("idcomp5").value;
                p.idcomp6 = doc.getElementById("idcomp6").value;
                p.idcomp7 = doc.getElementById("idcomp7").value;
                p.idcomp8 = doc.getElementById("idcomp8").value;
            }
        }
        function perso() {
            this.nom = "";
            this.img = "";
            this.classes = "";
            this.cdp = "";
            this.race = "";
            this.sexe = "";
            this.ctaille = "4";
            this.religion = "";
            this.origine = "";
            this.age = "";
            this.poids = "";
            this.taille = "";
            this.align = ""
            this.joueur = "";
            this.md = "";
            this.partie = "";
            this.yeux = "";
            this.cheveux = "";
            this.peau = "";
            this.dextrie = "";
            this.noteidentité = "";
            this.forbase = "10";
            this.dexbase = "10";
            this.conbase = "10";
            this.intbase = "10";
            this.sagbase = "10";
            this.chabase = "10";
            this.force = "10";
            this.dex = "10";
            this.con = "10";
            this.int = "10";
            this.sag = "10";
            this.cha = "10";
            this.initdiv = "0";
            this.initnote = "";
            this.vd = "";
            this.vision = "";
            this.notesexplo = "";
            this.refbase = "0";
            this.refdiv = "0";
            this.refnote = "";
            this.vigbase = "0";
            this.vigdiv = "0";
            this.vignote = "";
            this.volbase = "0";
            this.voldiv = "0";
            this.volnote = "";
            this.notesjds = "";
            this.pv = "0";
            this.pvmax = "0";
            this.dgnl = "0";
            this.notespv = "";
            this.bba = "0";
            this.bmo = "+0";
            this.dmd = "10";
            this.ca = "";
            this.cacontact = "";
            this.casurpris = "";
            this.notescombat = "";
            this.notescombat2 = "";
            this.armes = "";
            this.traits = "";
            this.cpmartiales = "";
            this.capacités = "";
            this.dons = "";
            this.languesbool = new Array(24);
            for (var i = 0; i < 24; i++)
                arrayset(this.languesbool, i, "0");
            this.langues = "";
            this.notescapacités = "";
            this.cnom = new Array(42);
            this.crangs = new Array(42);
            this.cclasse = new Array(42);
            this.cdivers = new Array(42);
            this.cnote = new Array(42);
            for (var i = 0; i < 42; i++) {
                arrayset(this.cnom, i, "");
                arrayset(this.crangs, i, "0");
                arrayset(this.cclasse, i, "0");
                arrayset(this.cdivers, i, "0");
                arrayset(this.cnote, i, "");
            }
            this.notescompétences = "";
            this.sortsparjour = new Array(10);
            this.sortsconnus = new Array(10);
            this.dd = new Array(10);
            for (var i = 0; i < 10; i++) {
                arrayset(this.sortsparjour, i, "");
                arrayset(this.sortsconnus, i, "");
                arrayset(this.dd, i, "");
            }
            this.domaines = "";
            this.sorts = "";
            this.notessorts = "";
            this.conc = "";
            this.notessortsniv = new Array(10);
            for (var i = 0; i < 10; i++)
                arrayset(this.notessortsniv, i, "");
            this.snom = new Array(500);
            this.snote = new Array(500);
            this.sprep = new Array(500);
            this.slanc = new Array(500);
            this.surl = new Array(500);
            for (var i = 0; i < 500; i++) {
                arrayset(this.snom, i, "");
                arrayset(this.snote, i, "");
                arrayset(this.sprep, i, "0");
                arrayset(this.slanc, i, "0");
                arrayset(this.surl, i, "");
            }
            this.parure = new Array(20);
            this.poidsparure = new Array(20);
            this.objets = new Array(150);
            this.poidsobjets = new Array(150);
            this.sacoches = new Array(6);
            this.sacochescompte = new Array(6);
            this.maxdexarmure = "";
            this.pénalitéarmure = "";
            this.échecsortsarmure = "";
            this.maxdexbouclier = "";
            this.pénalitébouclier = "";
            this.échecsortsbouclier = "";
            this.richesses = "";
            this.poidsrichesses = "0";
            this.noteséquipement = "";
            for (var i = 0; i < 6; i++) {
                arrayset(this.sacoches, i, "");
                arrayset(this.sacochescompte, i, "1");
            }
            for (var i = 0; i < 20; i++) {
                arrayset(this.parure, i, "");
                arrayset(this.poidsparure, i, "0");
            }
            for (var i = 0; i < 150; i++) {
                arrayset(this.objets, i, "");
                arrayset(this.poidsobjets, i, "0");
            }
            this.compnom = "";
            this.comprelation = "";
            this.comprace = "";
            this.comptype = "";
            this.comptaille = "";
            this.compinit = "";
            this.compvd = "";
            this.compvision = "";
            this.idcomp1 = "";
            this.compref = "";
            this.compvig = "";
            this.compvol = "";
            this.idcomp2 = "";
            this.comppv = "";
            this.comppvmax = "";
            this.compdgnl = "";
            this.idcomp3 = "";
            this.compfor = "";
            this.compdex = "";
            this.compcon = "";
            this.compint = "";
            this.compsag = "";
            this.compcha = "";
            this.compbba = "";
            this.compbmo = "";
            this.compdmd = "";
            this.compca = "";
            this.compcacontact = "";
            this.compcasurpris = "";
            this.idcomp4 = "";
            this.idcomp5 = "";
            this.idcomp6 = "";
            this.idcomp7 = "";
            this.idcomp8 = "";
            this.notes = "";
            this.showmagie = "1";
            this.showcomp = "1";
            this.showmagempty = "1";
        }
        function vide(o) {
            var children = o.childNodes;
            for (var i = 0; i < children.length; i++) o.removeChild(arrayget(children, i));
        }
        function statmod(v) {
            return (Math.floor(v / 2 - 5));
        }
        function statmodecho(v) {
            var sm = statmod(v);
            if (sm >= 0)
                return ("+" + sm);
            else
                return ("" + sm);
        }
        function statecho(v) {
            return ("<b>" + v + "</b> (" + statmodecho(v) + ")");
        }
        function modif(v, a) {
            var val = parseInt(v);
            return ("" + (val + a));
        }
        function zaffiche(v) {
            if (v >= 0)
                return ("+" + v);
            else
                return ("" + v);
        }
        function butpm(idp, idm) {
            var result = "<td align='center'><table cellpadding='0px'>";
            result += "<tr><td><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/BoutonP.jpg' width='8px' id='" + idp + "'/></td></tr>";
            result += "<tr><td><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/BoutonM.jpg' width='8px' id='" + idm + "'/></td></tr>";
            result += "</table></td>";
            return (result);
        }
        function butpme(idp, idm, ide) {
            var result = "<td align='center'><table cellpadding='0px'>";
            result += "<tr><td><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/BoutonP.jpg' width='8px' id='" + idp + "'/></td>";
            result += "<td rowspan='2'><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/BoutonE.jpg' width='8px' id='" + ide + "'/></td></tr>";
            result += "<tr><td><img src='http://www.pathfinder-fr.org/images/pathfinder/wiki/BoutonM.jpg' width='8px' id='" + idm + "'/></td></tr>";
            result += "</table></td>";
            return (result);
        }
        function no_accent(my_string) {
            var new_string = "";
            var pattern_accent = new Array("é", "è", "ê", "ë", "ç", "à", "â", "ä", "î", "ï", "ù", "ô", "ó", "ö", "É", "È", "Ê", "Ô", "À");
            var pattern_replace_accent = new Array("e", "e", "e", "e", "c", "a", "a", "a", "i", "i", "u", "o", "o", "o", "E", "E", "E", "O", "A");
            if (my_string && my_string != "") {
                new_string = preg_replace(pattern_accent, pattern_replace_accent, my_string);
            }
            return new_string;
        }
        function preg_replace(array_pattern, array_pattern_replace, my_string) {
            var new_string = String(my_string);
            for (i = 0; i < array_pattern.length; i++) {
                var reg_exp = RegExp(arrayget(array_pattern, i), "gi");
                var val_to_replace = arrayget(array_pattern_replace, i);
                new_string = new_string.replace(reg_exp, val_to_replace);
            }
            return new_string;
        }
        function elem(titre, val) {
            return "<li><b>" + titre + "</b> : " + val + "</li>";
        }


        // FDP WIKI

        function titre(tit) {
            var res = "<div class='fdptab' id='t" + tit + "'>";
            res += "<table cellspacing=0 cellpadding=0>";
            return res;
        }

        function ltitre(tit) {
            var res = "<li><a href='#t" + tit + "'>" + tit + "</a></li>";
            return res;
        }

        function stitre(tit) {
            return "<p class='fdpst'>" + tit + "</p>";
        }

        function stitresorts(tit) {
            return "<img class='btntogglesortsindisponibles' "
                   + "src='http://www.pathfinder-fr.org/Wiki/public/upload/Battlemaps/Boutons/beye.jpg' "
                   + "title='Afficher/masquer les sorts indisponibles'></img>"
                   + "<p class='fdpst'>" + tit + "</p>";
        }

        function tawiki(text) {
            if (text == "")
                return "";
            else {
                return "<p class='fdpta'>" + modbr(text) + "</p>";
            }
        }

        function affichewiki() {

            $("#fdpwikipic").attr("src", p.img);
            $("#fdpwikinom").html(p.nom);
            $("#fdpwikicol1").html(
              "<b>Joueur</b> : " + p.joueur + "<br/>" +
              "<b>MD</b> : " + p.md + "<br/>" +
              "<b>Partie</b> : " + p.partie + "<br/>"
            );

            var contenu0 = "<ul>";
            var contenu = titre("Identité");
            contenu0 += ltitre("Identité");
            contenu += "<tr>";
            contenu += "<td width='50%'>";
            contenu += stitre("Race et classe") + "<ul>";
            contenu += elem("Race", p.race);
            contenu += elem("Sexe", p.sexe);
            var ctaille = "Colossal (C),Gigantesque (Gig),Très Grand (TG),Grand (G),Moyen (M),Petit (P),Très Petit (TP),Minuscule (Min),Infime (I)";
            var cttab = ctaille.split(",");
            var cat = ((parseInt(p.ctaille) >= 0) && (parseInt(p.ctaille) <= 8)) ? arrayget(cttab, parseInt(p.ctaille)) : "?";
            contenu += elem("Catégorie de taille", cat);
            contenu += elem("Classe(s)", p.classes);
            contenu += elem("Prédilection", p.cdp);
            contenu += "</ul></td><td width='50%'>";
            contenu += stitre("Personnalité") + "<ul>";
            contenu += elem("Religion", p.religion);
            contenu += elem("Origine", p.origine);
            contenu += elem("Alignement", p.align);
            contenu += elem("Dextrie", p.dextrie);
            contenu += "</ul></td></tr><tr><td>";
            contenu += stitre("Caractéristiques") + "<ul>";
            contenu += elem("FOR", statecho(p.forbase) + ", actuellement " + statecho(p.force));
            contenu += elem("DEX", statecho(p.dexbase) + ", actuellement " + statecho(p.dex));
            contenu += elem("CON", statecho(p.conbase) + ", actuellement " + statecho(p.con));
            contenu += elem("INT", statecho(p.intbase) + ", actuellement " + statecho(p.int));
            contenu += elem("SAG", statecho(p.sagbase) + ", actuellement " + statecho(p.sag));
            contenu += elem("CHA", statecho(p.chabase) + ", actuellement " + statecho(p.cha));
            contenu += "</ul></td><td>";
            contenu += stitre("Description") + "<ul>";
            contenu += elem("Âge", p.age);
            contenu += elem("Poids", p.poids);
            contenu += elem("Taille", p.taille);
            contenu += elem("Yeux", p.yeux);
            contenu += elem("Cheveux", p.cheveux);
            contenu += elem("Peau", p.peau);
            contenu += "</ul></td></tr><tr><td colspan='2'>";
            contenu += stitre("Notes");
            contenu += tawiki(p.noteidentité);
            contenu += "</td></tr></table></div>";

            contenu += titre("Combat");
            contenu0 += ltitre("Combat");
            contenu += "<tr>";
            contenu += "<td width='33%'>";
            contenu += stitre("Exploration") + "<ul>";
            var val = statmod(p.dex) + parseInt(p.initdiv);
            var comm = commpre + " = " + zaffiche(statmod(p.dex)) + " Dex " + zaffiche(parseInt(p.initdiv)) + commpost;
            contenu += elem("Initiative", zaffiche(val) + comm + ((p.initnote == "") ? "" : " (" + p.initnote + ")"));
            contenu += elem("VD", p.vd);
            contenu += elem("Vision", p.vision);
            contenu += "</ul>";
            contenu += tawiki(p.notesexplo);
            contenu += "</td><td width='33%'>";
            contenu += stitre("Jets de sauvegarde") + "<ul>";
            val = statmod(p.dex) + parseInt(p.refbase) + parseInt(p.refdiv);
            comm = commpre + " = " + zaffiche(parseInt(p.refbase)) + " " + zaffiche(statmod(p.dex)) + " Dex " + zaffiche(parseInt(p.refdiv)) + commpost;
            contenu += elem("Réflexes", zaffiche(val) + comm + ((p.refnote == "") ? "" : " (" + p.refnote + ")"));
            var contenu1 = "<b>Réf :</b> " + zaffiche(val) + "<br/>";
            val = statmod(p.con) + parseInt(p.vigbase) + parseInt(p.vigdiv);
            comm = commpre + " = " + zaffiche(parseInt(p.vigbase)) + " " + zaffiche(statmod(p.con)) + " Con " + zaffiche(parseInt(p.vigdiv)) + commpost;
            contenu += elem("Vigueur", zaffiche(val) + comm + ((p.vignote == "") ? "" : " (" + p.vignote + ")"));
            contenu1 += "<b>Vig :</b> " + zaffiche(val) + "<br/>";
            val = statmod(p.sag) + parseInt(p.volbase) + parseInt(p.voldiv);
            comm = commpre + " = " + zaffiche(parseInt(p.volbase)) + " " + zaffiche(statmod(p.sag)) + " Sag " + zaffiche(parseInt(p.voldiv)) + commpost;
            contenu += elem("Volonté", zaffiche(val) + comm + ((p.volnote == "") ? "" : " (" + p.volnote + ")"));
            contenu1 += "<b>Vol :</b> " + zaffiche(val) + "<br/>";
            $("#fdpwikicol2").html(contenu1);
            contenu += "</ul>";
            contenu += tawiki(p.notesjds);
            contenu += "</td><td width='33%'>";
            contenu += stitre("Points de vie") + "<ul>";
            contenu += elem("pv actuels", p.pv);
            contenu += elem("pv max", p.pvmax);
            contenu += elem("Dg non létaux", p.dgnl);
            contenu1 = "<b>pv :</b> " + p.pv + "/" + p.pvmax + "<br/>";
            contenu += "</ul>";
            contenu += tawiki(p.notespv);
            contenu += "</td></tr>";
            contenu += "<tr><td>";
            contenu += stitre("Valeurs de combat") + "<ul>";
            contenu += elem("BBA", zaffiche(p.bba));
            contenu += elem("BMO", p.bmo);
            contenu += elem("DMD", p.dmd);
            contenu += elem("CA", p.ca);
            contenu += elem("CA contact", p.cacontact);
            contenu += elem("CA surpris", p.casurpris);
            contenu1 += "<b>CA :</b> " + p.ca + " (contact " + p.cacontact + ", surpris " + p.casurpris + ")<br/>";
            contenu1 += "<b>BMC/DMC :</b> " + p.bmo + "/" + p.dmd;
            $("#fdpwikicol3").html(contenu1);
            contenu += "</ul>";
            contenu += tawiki(p.notescombat);
            contenu += "</td><td colspan='2'>";
            contenu += stitre("Armes et modes d'attaque");
            contenu += tawiki(p.armes);
            contenu += "</td></tr>";
            contenu += "<tr><td colspan='3'>";
            contenu += stitre("Notes");
            contenu += tawiki(p.notescombat2);
            contenu += "</td></tr></table></div>";

            contenu += titre("Capacités");
            contenu0 += ltitre("Capacités");
            contenu += "<tr>";
            contenu += "<td width='50%'>";
            contenu += stitre("Traits et traits raciaux");
            contenu += tawiki(p.traits);
            contenu += "</td><td width='50%'>";
            contenu += stitre("Compétences martiales");
            contenu += tawiki(p.cpmartiales);
            contenu += "</tr><tr><td>";
            contenu += stitre("Capacités de classe");
            contenu += tawiki(p.capacités);
            contenu += "</td><td>";
            contenu += stitre("Dons");
            contenu += tawiki(p.dons);
            contenu += "</tr><tr><td>";
            contenu += stitre("Langues");
            val = "";
            for (var i = 0; i < lgl; i++)
                if (arrayget(p.languesbool, i) == "1")
                    val += ", " + arrayget(lgtab, i);
            if (val != "")
                val = val.substring(2);
            contenu += "<p>" + val + "</p>";
            contenu += tawiki(p.langues);
            contenu += "</td><td>";
            contenu += stitre("Notes");
            contenu += tawiki(p.notescapacités);
            contenu += "</td></tr></table></div>";

            contenu += titre("Compétences");
            contenu0 += ltitre("Compétences");
            contenu += "<tr><td colspan='2'>" + stitre("Compétences");
            contenu += "<table class='tabcpt'><tr>";
            contenu += "<td width='50%'><ul>";
            for (var i = 0; i < cl; i++) {
                var nom = arrayget(ctab, i);
                var inne = (nom.substring(0, 1) == "I");
                if (inne) nom = nom.substring(1);
                var cstat = parseInt(nom.substring(0, 1));
                var ajout = (nom.substring(1, 2) == '*');
                nom = nom.substring(ajout ? 2 : 1);
                var pos = nom.indexOf("!");
                var url = "http://www.pathfinder-fr.org/Wiki/Pathfinder-RPG." + nom.substring(pos + 1) + ".ashx";
                if (pos > 0)
                    nom = nom.substring(0, pos);
                if (ajout)
                    nom = nom + " (" + arrayget(p.cnom, i) + ")";
                if (i == cl / 2)
                    contenu += "</ul></td><td width='50'><ul>";
                nom = "<a href='" + url + "'>" + nom + "</a>";
                val = parseInt(arrayget(p.crangs, i));
                var entraine = (val > 0);
                comm = commpre + " = " + arrayget(p.crangs, i) + " rg";
                if (arrayget(p.crangs, i) > 1)
                    comm += "s";
                comm += " ";
                switch (cstat) {
                    case 1: val += statmod(p.force); comm += zaffiche(statmod(p.force)) + " For "; break;
                    case 2: val += statmod(p.dex); comm += zaffiche(statmod(p.dex)) + " Dex "; break;
                    case 3: val += statmod(p.con); comm += zaffiche(statmod(p.con)) + " Con "; break;
                    case 4: val += statmod(p.int); comm += zaffiche(statmod(p.int)) + " Int "; break;
                    case 5: val += statmod(p.sag); comm += zaffiche(statmod(p.sag)) + " Sag "; break;
                    case 6: val += statmod(p.cha); comm += zaffiche(statmod(p.cha)) + " Cha "; break;
                }
                if (entraine && (arrayget(p.cclasse, i) == '1')) {
                    val += 3;
                    comm += " +3 ";
                }
                val = val + parseInt(arrayget(p.cdivers, i));
                comm += zaffiche(parseInt(arrayget(p.cdivers, i))) + commpost;
                var util = inne || entraine;
                var penarm = (cstat == 2) || (cstat == 1);;
                val = (util ? "" : "(") + zaffiche(val) + (penarm ? "*" : "") + (util ? "" : ")");
                if (arrayget(p.cnote, i) != "")
                    val += " (" + arrayget(p.cnote, i) + ")";
                contenu += "<li>" + nom + " : " + val + comm + "</li>";
            }
            contenu += "</ul></td></tr>";
            contenu += "<tr><td colspan='2'><i>* : appliquer la pénalité d'armure; ";
            contenu += "(+x) : compétence non innée</i></td></tr>";
            contenu += "</table></td></tr>";
            contenu += "<tr><td colspan='2'>";
            contenu += stitre("Notes");
            contenu += tawiki(p.notescompétences);
            contenu += "</td></tr></table></div>";

            if (p.showmagie == "1") {
                contenu += titre("Magie");
                contenu0 += ltitre("Magie");
                contenu += "<tr>";
                contenu += "<td width='50%'>";
                contenu += stitre("Sorts");
                contenu += "<b>Concentration :</b> " + p.conc + "<br/>";
                contenu += tawiki(p.notessorts);
                contenu += "</td><td width='50%' rowspan='2'>";
                contenu += stitre("Domaines, écoles, lignages");
                contenu += tawiki(p.domaines);
                contenu += "</td></tr>";
                contenu += "<tr><td>";
                contenu += stitre("Notes");
                contenu += tawiki(p.sorts);
                contenu += "</td></tr>";
                for (var i = 0; i < 10; i++) {
                    if (i % 2 == 0)
                        contenu += "</tr><tr>";
                    var lsorts = "";
                    var nprep = 0;
                    var nlanc = 0;
                    for (var j = i * 50; j < 50 * (i + 1) ; j++)
                        if (arrayget(p.snom, j) != "") {
                            var np = parseInt(arrayget(p.sprep, j));
                            var nl = parseInt(arrayget(p.slanc, j));
                            lsorts += "<li";
                            if (np == 0 || nl == np)
                                lsorts += " class='pasdisp'";
                            lsorts += ">";
                            if (arrayget(p.surl, j) != "")
                                lsorts += "<a href='" + arrayget(p.surl, j) + "' target='blank'><i>" + arrayget(p.snom, j) + "</i></a>";
                            else
                                lsorts += "<i>" + arrayget(p.snom, j) + "</i>";
                            lsorts += " : " + np + " préparé" + (np > 1 ? "s" : "");
                            lsorts += ", " + nl + " lancé" + (nl > 1 ? "s" : "");
                            if (arrayget(p.snote, j) != "")
                                lsorts += " (" + arrayget(p.snote, j) + ")";
                            lsorts += "</li>";
                            nprep += np;
                            nlanc += nl;
                        }
                    if (lsorts == "")
                        lsorts = "Aucun sort<br/>";
                    else
                        lsorts = "<ul>" + lsorts + "</ul>";
                    if ((p.showmagempty == "1") || (lsorts != "Aucun sort<br/>")) {
                        contenu += "<td>";
                        contenu += stitresorts("Niveau " + i + " (DD " + arrayget(p.dd, i) + ")");
                        contenu += "<b>Sorts connus</b> : " + arrayget(p.sortsconnus, i) + "<br/>";
                        contenu += "<b>Sorts par jour</b> : " + arrayget(p.sortsparjour, i) + " (";
                        contenu += nprep + " préparé" + (nprep > 1 ? "s" : "") + ", ";
                        contenu += nlanc + " lancé" + (nlanc > 1 ? "s" : "") + ")<br/>";
                        contenu += lsorts;
                        if (arrayget(p.notessortsniv, i) != "")
                            contenu += tawiki(arrayget(p.notessortsniv, i));
                        contenu += "</td>";
                    }
                }
                contenu += "</tr></table></div>";
            }

            contenu += titre("Équipement");
            contenu0 += ltitre("Équipement");
            var totpds = 0.0;
            contenu += "<tr>";
            contenu += "<td rowspan='2' width='50%'>";
            var cpds = 0.0;
            var lequip = "<ul>";
            for (var i = 0; i < pl; i++) {
                if (arrayget(ptab, i).substring(0, 1) != "*") {
                    lequip += "<li><b>" + arrayget(ptab, i) + " :</b> " + arrayget(p.parure, i) + " (" + arrayget(p.poidsparure, i) + "kg";
                    if (arrayget(ptab, i) == "Armure")
                        lequip += ", MaxDex " + p.maxdexarmure + ", Pénal " + p.pénalitéarmure + ", Éch sorts " + p.échecsortsarmure;
                    if (arrayget(ptab, i) == "Bouclier")
                        lequip += ", MaxDex " + p.maxdexbouclier + ", Pénal " + p.pénalitébouclier + ", Éch sorts " + p.échecsortsbouclier;
                    lequip += ")</li>";
                }
                cpds += parseFloat(arrayget(p.poidsparure, i));
            }
            contenu += stitre("Sur le corps (" + cpds + " kg)") + lequip + "</ul>";
            totpds += cpds;
            contenu += "</td><td width='50%'>";
            contenu += stitre("Richesses (" + p.poidsrichesses + " kg)");
            contenu += tawiki(p.richesses) + "</td>";
            totpds += parseFloat(p.poidsrichesses);
            contenu += "</td></tr><td>";
            contenu += stitre("Notes");
            contenu += tawiki(p.noteséquipement) + "</td>";
            contenu += "</td>";
            for (var i = 0; i < 6; i++) {
                lequip = "";
                cpds = 0;
                for (var j = 25 * i; j < 25 * (i + 1) ; j++) {
                    if ((arrayget(p.objets, j) != "") || (arrayget(p.poidsobjets, j) != "0"))
                        lequip += "<li>" + arrayget(p.objets, j) + " (" + arrayget(p.poidsobjets, j) + " kg)</li>";
                    cpds += parseFloat(arrayget(p.poidsobjets, j));
                }
                if (lequip == "")
                    lequip = "Aucun objet";
                else
                    lequip = "<ul>" + lequip + "</ul>";
                if (i % 2 == 0)
                    contenu += "</tr><tr>";
                contenu += "<td>";
                var stit = "Sac #" + (i + 1) + " : " + arrayget(p.sacoches, i) + " (" + cpds + " kg";
                if (arrayget(p.sacochescompte, i) == "0")
                    stit += ", pds non compté";
                else
                    totpds += cpds;
                stit += ")";
                contenu += stitre(stit) + lequip + "</td>";
            }
            contenu += "</tr>";
            totpds = Math.round(totpds * 100) / 100;
            contenu += "<tr><td colspan='2'>" + stitre("Poids total");
            contenu += "<b>" + totpds + " kg</b>";
            var forc = parseInt(p.force);
            var mult = 1;
            while (forc > 29) {
                forc = forc - 10;
                mult = mult * 4;
            }
            var chm = parseFloat(arrayget(chmoytab, forc - 1)) * mult * arrayget(chmodtailletab, parseInt(p.ctaille));
            var chl = parseFloat(arrayget(chloutab, forc - 1)) * mult * arrayget(chmodtailletab, parseInt(p.ctaille));
            var chx = parseFloat(arrayget(chmaxtab, forc - 1)) * mult * arrayget(chmodtailletab, parseInt(p.ctaille));
            if (totpds < chm)
                contenu += " charge légère (pas de pénalité)";
            else if (totpds < chl)
                contenu += " charge moyenne (Max Dex +3, pénalité -3, course ×4, VD réduite)";
            else if (totpds < chx)
                contenu += " charge lourde (Max Dex +1, pénalité -6, course ×3, VD réduite)";
            else
                contenu += " charge extrême (ne peut se déplacer)";
            contenu += "</td></tr></table></div>";

            if (p.showcomp == "1") {
                contenu += titre("Compagnon");
                contenu0 += ltitre("Compagnon");
                contenu += "<tr>";
                contenu += "<td width='33%'>";
                contenu += stitre("Identité") + "<ul>";
                contenu += elem("Nom", p.compnom);
                contenu += elem("Relation", p.comprelation);
                contenu += elem("Race", p.comprace);
                contenu += elem("Type", p.comptype);
                contenu += elem("Taille", p.comptaille);
                contenu += "</ul>";
                contenu += "</td><td width='33%'>";
                contenu += stitre("Exploration") + "<ul>";
                contenu += elem("Init", p.compinit);
                contenu += elem("VD", p.compvd);
                contenu += elem("Vision", p.compvision);
                contenu += "</ul>";
                contenu += tawiki(p.idcomp1);
                contenu += "</td><td width='33%'>";
                contenu += stitre("Jets de sauvegarde") + "<ul>";
                contenu += elem("Réf", p.compref);
                contenu += elem("Vig", p.compvig);
                contenu += elem("Vol", p.compvol);
                contenu += "</ul>";
                contenu += tawiki(p.idcomp2);
                contenu += "</td></tr><tr><td>";
                contenu += stitre("Caractéristiques") + "<ul>";
                contenu += elem("For", p.compfor);
                contenu += elem("Dex", p.compdex);
                contenu += elem("Con", p.compcon);
                contenu += elem("Int", p.compint);
                contenu += elem("Sag", p.compsag);
                contenu += elem("Cha", p.compcha);
                contenu += "</td><td>";
                contenu += stitre("Valeurs de combat") + "<ul>";
                contenu += elem("BBA", p.compbba);
                contenu += elem("BMO", p.compbmo);
                contenu += elem("DMD", p.compdmd);
                contenu += elem("CA", p.compca);
                contenu += elem("CA contact", p.compcacontact);
                contenu += elem("CA surpris", p.compcasurpris);
                contenu += "</td><td>";
                contenu += stitre("Points de vie") + "<ul>";
                contenu += elem("pv actuels", p.comppv);
                contenu += elem("pv max", p.comppvmax);
                contenu += elem("Dg non létaux", p.compdgnl);
                contenu += "</ul>";
                contenu += tawiki(p.idcomp3);
                contenu += "</td></tr><tr><td>";
                contenu += stitre("Compétences");
                contenu += tawiki(p.idcomp5);
                contenu += "</td><td colspan='2'>";
                contenu += stitre("Attaques");
                contenu += tawiki(p.idcomp4);
                contenu += "</td></tr><tr><td>";
                contenu += stitre("Dons");
                contenu += tawiki(p.idcomp6);
                contenu += "</td><td colspan='2'>";
                contenu += stitre("Capacités spéciales");
                contenu += tawiki(p.idcomp7);
                contenu += "</td></tr><tr><td colspan='3'>";
                contenu += stitre("Notes");
                contenu += tawiki(p.idcomp8);
                contenu += "</td></tr></table></div>";
            }

            contenu += titre("Notes");
            contenu0 += ltitre("Notes");
            contenu += "<tr><td width='100%'>" + tawiki(p.notes) + "</td></tr></table></div>";

            $("#maintarget").html(contenu0 + "</ul>" + contenu);
            $("#maintarget").tabs();

            $(".btntogglesortsindisponibles").click(
              function () { $(".pasdisp").toggle(); }
            );

        }
        function modbr(s) {
            return (s.replace(/\n/g, "<br/>"));
        }
        function modifvis(id) {
            var target = document.getElementById(id);
            $("#" + id).slideToggle("normal");
        }

        function arrayset(tab, i, v) {
            tab[i] = v;
        }
        function arrayget(tab, i) {
            return tab[i];
        }

    </script>

</body>
</html>